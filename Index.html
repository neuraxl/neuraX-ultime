<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuraX Hub — Supervision Neuronale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;700&display=swap');

        :root {
            --neon-cyan: #06b6d4;
            --neon-purple: #d946ef;
            --neon-amber: #f59e0b;
            --neon-green: #22c55e;
            --bg-dark: #050505;
            --panel-bg: rgba(10, 10, 12, 0.85);
        }

        body {
            background-color: var(--bg-dark);
            color: #94a3b8;
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        /* Scrollbar futuriste */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-cyan); }

        /* Boutons et Panneaux */
        .panel {
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid #1e293b;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        .btn-tool {
            transition: all 0.2s ease;
            border: 1px solid #1e293b;
            background: rgba(30, 41, 59, 0.5);
            color: #94a3b8;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .btn-tool:hover {
            border-color: var(--neon-cyan);
            color: #fff;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.4);
            text-shadow: 0 0 8px var(--neon-cyan);
        }
        .btn-tool:active { transform: scale(0.98); }

        /* Sliders stylisés */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
            height: 20px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 2px;
            background: #334155;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 10px; width: 10px;
            background: var(--neon-cyan);
            margin-top: -4px;
            transform: rotate(45deg);
            border: 1px solid #fff;
            box-shadow: 0 0 10px var(--neon-cyan);
            cursor: pointer;
        }

        /* Effets CRT / Scanline */
        .scanline {
            background: repeating-linear-gradient(
                to bottom,
                transparent 0px,
                transparent 2px,
                rgba(0, 0, 0, 0.3) 3px,
                rgba(0, 0, 0, 0.3) 4px
            );
            pointer-events: none;
        }
        .vignette {
            background: radial-gradient(circle, transparent 60%, rgba(0,0,0,0.8) 100%);
            pointer-events: none;
        }

        /* Animations */
        @keyframes pulse-slow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        .animate-pulse-slow { animation: pulse-slow 3s infinite; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col text-xs relative select-none">

    <!-- FX Overlays -->
    <div class="absolute inset-0 scanline z-50 opacity-20"></div>
    <div class="absolute inset-0 vignette z-50"></div>

    <!-- HEADER -->
    <header class="h-10 border-b border-gray-800 bg-black/90 flex items-center justify-between px-4 z-20 shrink-0 backdrop-blur-md">
        <div class="flex items-center gap-3">
            <div class="relative w-4 h-4 flex items-center justify-center">
                <div class="absolute inset-0 bg-cyan-500 rounded-full animate-ping opacity-20"></div>
                <div class="w-2 h-2 bg-cyan-400 rounded-full shadow-[0_0_10px_#06b6d4]"></div>
            </div>
            <h1 class="font-orbitron text-base text-cyan-100 tracking-[0.2em] drop-shadow-[0_0_5px_rgba(6,182,212,0.5)]">
                NEURA<span class="text-cyan-500">X</span> HUB <span class="text-gray-600 text-[10px] ml-2 align-super">v2.1.0</span>
            </h1>
        </div>
        <div class="flex gap-2 font-mono">
            <div class="flex items-center gap-2 px-3 py-1 bg-gray-900 border border-gray-800 rounded text-xs">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-green-500">ONLINE</span>
            </div>
            <button onclick="resetSim()" class="px-3 py-1 bg-red-900/20 hover:bg-red-900/40 text-red-400 border border-red-900/50 rounded transition-colors">PURGE</button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <div class="flex-1 flex overflow-hidden relative">

        <!-- LEFT: CONTROLS -->
        <aside class="w-72 bg-gray-900/80 border-r border-gray-800 flex flex-col shrink-0 z-10 backdrop-blur-sm">
            
            <!-- Metrics Graph Placeholder -->
            <div class="h-24 border-b border-gray-800 bg-black/50 p-2 relative overflow-hidden">
                <div class="text-[10px] font-bold text-gray-500 mb-1">CHARGE NEURONALE</div>
                <div class="flex items-end justify-between h-full pb-4 gap-0.5" id="mini-graph">
                    <!-- JS generates bars here -->
                </div>
                <div class="absolute top-0 right-0 p-1 text-[9px] text-cyan-600">MONITORING</div>
            </div>

            <div class="p-4 flex-1 overflow-y-auto space-y-6">
                
                <!-- Forces -->
                <div>
                    <h2 class="text-xs font-orbitron text-amber-500 mb-3 flex items-center gap-2 tracking-wider">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        CONSTANTES
                    </h2>
                    <div class="space-y-3 text-[10px]">
                        <div class="group">
                            <div class="flex justify-between mb-1"><span class="text-cyan-300">Résonance Synaptique</span> <span id="val-resonance" class="font-mono">60%</span></div>
                            <input type="range" id="range-resonance" min="0" max="100" value="60">
                        </div>
                        <div class="group">
                            <div class="flex justify-between mb-1"><span class="text-purple-300">Flux de Données</span> <span id="val-flux" class="font-mono">60%</span></div>
                            <input type="range" id="range-flux" min="0" max="100" value="60">
                        </div>
                        <div class="group">
                            <div class="flex justify-between mb-1"><span class="text-green-300">Auto-Genèse</span> <span id="val-autogen" class="font-mono">30%</span></div>
                            <input type="range" id="range-autogen" min="0" max="100" value="30">
                        </div>
                    </div>
                </div>

                <!-- Tools -->
                <div>
                    <h2 class="text-xs font-orbitron text-purple-500 mb-3 flex items-center gap-2 tracking-wider">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                        PROTOCOLES
                    </h2>
                    
                    <!-- Grid of actions -->
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="spawn('glint')" class="btn-tool py-2 px-2 rounded flex flex-col items-center gap-1">
                            <span class="text-[9px] uppercase tracking-wide text-cyan-400">Inject Node</span>
                            <div class="w-full h-0.5 bg-cyan-900"><div class="h-full w-1/2 bg-cyan-400"></div></div>
                        </button>
                        <button onclick="spawn('leviathan')" class="btn-tool py-2 px-2 rounded flex flex-col items-center gap-1">
                            <span class="text-[9px] uppercase tracking-wide text-purple-400">Deploy Core</span>
                            <div class="w-full h-0.5 bg-purple-900"><div class="h-full w-1/2 bg-purple-400"></div></div>
                        </button>
                    </div>

                    <div class="mt-2 space-y-2">
                        <div class="flex gap-1">
                            <button onclick="engineForge('stabilize')" class="btn-tool flex-1 py-1 text-[10px] rounded border-l-2 border-l-amber-500">Stabilize</button>
                            <button onclick="engineForge('optimize')" class="btn-tool flex-1 py-1 text-[10px] rounded">Optimize</button>
                        </div>
                        <div class="flex gap-1">
                            <button onclick="engineChoir('harmonize')" class="btn-tool flex-1 py-1 text-[10px] rounded border-l-2 border-l-blue-500">Harmonize</button>
                            <button onclick="triggerRite()" class="btn-tool flex-1 py-1 text-[10px] rounded text-purple-300">Invoke Rite</button>
                        </div>
                    </div>
                </div>

                <!-- Temporal -->
                <div class="bg-black/30 p-2 rounded border border-gray-800">
                    <label class="text-[9px] font-bold text-gray-500 mb-1 block">MANIPULATION TEMPORELLE</label>
                    <div class="flex rounded overflow-hidden border border-gray-700">
                        <button onclick="timeControl(-1)" class="flex-1 bg-gray-800 hover:bg-gray-700 text-gray-400 py-1">◄◄</button>
                        <button onclick="timeControl(0)" class="flex-1 bg-gray-800 hover:bg-gray-700 text-gray-400 py-1 border-x border-gray-700">❚❚</button>
                        <button onclick="timeControl(1)" class="flex-1 bg-gray-800 hover:bg-gray-700 text-gray-400 py-1">►</button>
                        <button onclick="timeControl(2)" class="flex-1 bg-gray-800 hover:bg-gray-700 text-gray-400 py-1 border-l border-gray-700">►►</button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- CENTER: VISUALIZATION -->
        <main class="flex-1 flex flex-col relative bg-black cursor-crosshair">
            
            <!-- HUD Overlay -->
            <div class="absolute top-4 left-4 right-4 flex justify-between pointer-events-none z-10">
                <!-- Left Stats -->
                <div class="flex flex-col gap-1">
                    <div class="text-[10px] text-cyan-600 font-bold tracking-widest">TOPOLOGIE RÉSEAU</div>
                    <div class="flex items-baseline gap-2">
                        <span class="text-3xl font-orbitron text-cyan-400 drop-shadow-[0_0_8px_rgba(6,182,212,0.8)]" id="hud-nodes">0</span>
                        <span class="text-xs text-gray-500">ACTIFS</span>
                    </div>
                    <div class="text-[10px] text-purple-400 mt-1">DENSITÉ: <span id="hud-density" class="text-white font-mono">0.00</span>/cm³</div>
                </div>
                
                <!-- Center Status -->
                <div class="text-center pt-2">
                    <div class="inline-block px-4 py-1 border border-gray-700 bg-black/60 backdrop-blur rounded-full">
                        <span class="text-[10px] text-gray-400">ÉTAT SYSTÈME:</span>
                        <span id="system-status" class="text-green-400 font-bold ml-1 animate-pulse-slow">NOMINAL</span>
                    </div>
                </div>

                <!-- Right Clock -->
                <div class="text-right">
                     <div class="text-[10px] text-gray-600 font-bold tracking-widest">TEMPS UNIVERSEL</div>
                     <div class="text-xl font-mono text-gray-300" id="clock">00:00:00</div>
                     <div class="text-[10px] text-amber-600">CYCLE: <span id="hud-cycle">T3-FRACTURE</span></div>
                </div>
            </div>

            <!-- CANVAS -->
            <canvas id="simCanvas" class="w-full h-full block"></canvas>

            <!-- Floating Terminal Input -->
            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 w-96 max-w-full px-4">
                <div class="bg-black/80 backdrop-blur border border-gray-700 rounded-lg p-1 flex items-center shadow-2xl shadow-purple-900/20">
                    <span class="text-green-500 px-2 font-mono">></span>
                    <input type="text" id="dsl-input" placeholder="Entrer commande (ex: spawn 10)..." class="bg-transparent border-none text-cyan-300 text-xs w-full focus:outline-none font-mono h-8">
                </div>
            </div>

        </main>

        <!-- RIGHT: LOGS & LAYERS -->
        <aside class="w-64 bg-gray-900/90 border-l border-gray-800 flex flex-col shrink-0 z-10 backdrop-blur-sm">
            
            <div class="flex items-center justify-between px-3 py-2 bg-black/40 border-b border-gray-800">
                <span class="text-[10px] font-bold text-gray-500 uppercase">Journal d'événements</span>
                <div class="flex gap-1">
                    <div class="w-1.5 h-1.5 rounded-full bg-gray-600"></div>
                    <div class="w-1.5 h-1.5 rounded-full bg-gray-600"></div>
                </div>
            </div>
            
            <div id="terminal-output" class="flex-1 overflow-y-auto p-3 font-mono text-[10px] space-y-1.5 text-gray-400 scroll-smooth">
                <div class="text-green-500 border-l-2 border-green-500 pl-2 bg-green-900/10 py-1">
                    [SYS] Initialisation du noyau...<br>
                    [SYS] Moteur graphique: CANVAS_2D_HQ<br>
                    [SYS] Prêt.
                </div>
            </div>

            <!-- Layers Control -->
            <div class="h-1/3 border-t border-gray-800 p-3 bg-black/20">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase mb-2 tracking-wider">VUES SPECTRALES</h3>
                <div class="space-y-2">
                    <label class="flex items-center justify-between cursor-pointer group">
                        <span class="text-cyan-200 group-hover:text-white transition-colors">Synapses</span>
                        <input type="checkbox" checked onchange="toggleLayer('synapses')" class="accent-cyan-500"> 
                    </label>
                    <label class="flex items-center justify-between cursor-pointer group">
                        <span class="text-purple-200 group-hover:text-white transition-colors">Noyaux (Nodes)</span>
                        <input type="checkbox" checked onchange="toggleLayer('nodes')" class="accent-purple-500"> 
                    </label>
                    <label class="flex items-center justify-between cursor-pointer group">
                        <span class="text-green-200 group-hover:text-white transition-colors">Signaux</span>
                        <input type="checkbox" checked onchange="toggleLayer('signals')" class="accent-green-500"> 
                    </label>
                </div>
            </div>
        </aside>
    </div>

    <script>
        /* --- CONFIGURATION & STATE --- */
        const CONFIG = {
            colors: {
                node: '#06b6d4',
                core: '#d946ef',
                scribe: '#22c55e',
                server_openai: '#10a37f', // OpenAI Green
                server_gemini: '#4b90ff', // Gemini Blue
                server_claude: '#da7756', // Claude Orange
                synapse: 'rgba(6, 182, 212, 0.15)',
                signal: '#ffffff'
            },
            connectionDistance: 120,
            maxNodes: 150
        };

        let state = {
            nodes: [],
            signals: [], 
            paused: false,
            timeScale: 1,
            resonance: 60,
            flux: 60,
            autogen: 30,
            layers: { synapses: true, nodes: true, signals: true },
            lastFrame: 0
        };

        /* --- CANVAS --- */
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d', { alpha: false });

        function resize() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        /* --- CLASSES --- */
        class Node {
            constructor(type, x, y, label = '') {
                this.id = Math.random().toString(36).substr(2, 5).toUpperCase();
                this.type = type; 
                this.x = x || Math.random() * canvas.width;
                this.y = y || Math.random() * canvas.height;
                this.label = label;
                
                // Server types are heavy and slower
                if (this.type === 'server') {
                    this.vx = (Math.random() - 0.5) * 0.2;
                    this.vy = (Math.random() - 0.5) * 0.2;
                    this.size = 12; 
                } else {
                    this.vx = (Math.random() - 0.5) * (Math.random() * 2);
                    this.vy = (Math.random() - 0.5) * (Math.random() * 2);
                    this.size = type === 'leviathan' ? 6 : (type === 'scribe' ? 3 : 1.5);
                }
                
                this.pulse = 0;
            }

            update(dt) {
                // Movement logic
                const speed = (state.flux / 50) * state.timeScale;
                this.x += this.vx * speed;
                this.y += this.vy * speed;

                // Bounce
                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;

                // Bounds clamp
                this.x = Math.max(0, Math.min(canvas.width, this.x));
                this.y = Math.max(0, Math.min(canvas.height, this.y));

                // Pulse decay
                if (this.pulse > 0) this.pulse -= 0.05 * state.timeScale;
            }
        }

        class Signal {
            constructor(startNode, endNode) {
                this.start = startNode;
                this.end = endNode;
                this.progress = 0;
                this.speed = 0.02 + (Math.random() * 0.03);
                this.dead = false;
            }

            update() {
                this.progress += this.speed * state.timeScale * (state.flux / 40);
                if (this.progress >= 1) {
                    this.dead = true;
                    this.end.pulse = 1; // Excitation
                }
            }

            draw(ctx) {
                if (this.dead) return;
                const x = this.start.x + (this.end.x - this.start.x) * this.progress;
                const y = this.start.y + (this.end.y - this.start.y) * this.progress;
                
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(x, y, 1.5, 0, Math.PI * 2);
                ctx.fill();
                
                // Glow trail
                ctx.shadowBlur = 4;
                ctx.shadowColor = '#fff';
            }
        }

        /* --- ENGINE --- */
        function init() {
            // Clean start
            state.nodes = [];
            
            // Spawn AI SERVERS
            // Position them in a triangle formation roughly
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            
            // OpenAI (Green)
            state.nodes.push(new Node('server', cx - 150, cy + 50, 'OpenAI'));
            // Gemini (Blue)
            state.nodes.push(new Node('server', cx, cy - 100, 'Gemini'));
            // Claude (Orange)
            state.nodes.push(new Node('server', cx + 150, cy + 50, 'Claude'));

            spawn('glint', 30);
            spawn('leviathan', 3);
            
            // Force resize to be sure
            resize();
            
            loop(0);
            setInterval(slowLogic, 500);
            initMiniGraph();
            
            log("[SYS] Serveurs IA connectés: OpenAI, Gemini, Claude.");
        }

        function spawn(type, count = 1) {
            for (let i = 0; i < count; i++) {
                if (state.nodes.length >= CONFIG.maxNodes) break;
                state.nodes.push(new Node(type));
            }
            if(type !== 'glint') log(`Injection: ${count} ${type}(s)`);
        }

        function loop(timestamp) {
            if (!state.paused) {
                ctx.fillStyle = '#050505';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                updateEntities();

                ctx.globalCompositeOperation = 'screen'; 
                drawSynapses();
                if (state.layers.signals) drawSignals();
                if (state.layers.nodes) drawNodes();
                ctx.globalCompositeOperation = 'source-over';
            }
            requestAnimationFrame(loop);
        }

        function updateEntities() {
            state.nodes.forEach(n => n.update());
            
            state.signals.forEach(s => s.update());
            state.signals = state.signals.filter(s => !s.dead);

            // Chance to spawn signal on connection
            if (state.flux > 10 && Math.random() < (state.flux / 2000)) {
                const n1 = state.nodes[Math.floor(Math.random() * state.nodes.length)];
                // Prefer connections to servers
                let dist = CONFIG.connectionDistance;
                // Servers have larger gravitational pull for signals
                if(n1.type === 'server') dist *= 2.5; 

                let neighbors = state.nodes.filter(n2 => n1 !== n2 && Math.hypot(n1.x-n2.x, n1.y-n2.y) < dist);
                if (neighbors.length > 0) {
                    const n2 = neighbors[Math.floor(Math.random() * neighbors.length)];
                    state.signals.push(new Signal(n1, n2));
                }
            }
            
            if (state.nodes.length < 25 && state.autogen > 0) spawn('glint');
        }

        function drawSynapses() {
            if (!state.layers.synapses) return;

            ctx.lineWidth = 1;
            for (let i = 0; i < state.nodes.length; i++) {
                for (let j = i + 1; j < state.nodes.length; j++) {
                    const n1 = state.nodes[i];
                    const n2 = state.nodes[j];
                    const d = Math.hypot(n1.x - n2.x, n1.y - n2.y);
                    
                    // Servers have longer reach
                    let maxDist = CONFIG.connectionDistance;
                    if (n1.type === 'server' || n2.type === 'server') maxDist *= 2;

                    if (d < maxDist) {
                        const opacity = 1 - (d / maxDist);
                        // Use server color if connected to server
                        let color = CONFIG.colors.synapse;
                        if (n1.type === 'server') color = hexToRgba(getColorForNode(n1), opacity * 0.5);
                        else if (n2.type === 'server') color = hexToRgba(getColorForNode(n2), opacity * 0.5);
                        else color = `rgba(6, 182, 212, ${opacity * 0.3})`;

                        ctx.strokeStyle = color;
                        ctx.beginPath();
                        ctx.moveTo(n1.x, n1.y);
                        ctx.lineTo(n2.x, n2.y);
                        ctx.stroke();
                    }
                }
            }
        }

        function drawNodes() {
            state.nodes.forEach(n => {
                ctx.fillStyle = getColorForNode(n);
                
                const glow = n.pulse * 10 + (n.type === 'server' ? 10 : 2);
                ctx.shadowBlur = glow;
                ctx.shadowColor = ctx.fillStyle;

                ctx.beginPath();
                
                if (n.type === 'server') {
                    // Draw Server as Square/Rhombus
                    const s = n.size + n.pulse;
                    ctx.rect(n.x - s, n.y - s, s*2, s*2);
                } else {
                    // Standard circle
                    ctx.arc(n.x, n.y, n.size + n.pulse, 0, Math.PI * 2);
                }
                ctx.fill();

                // Labels
                if (n.type === 'server') {
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 10px Orbitron';
                    ctx.textAlign = 'center';
                    ctx.fillText(n.label, n.x, n.y - n.size - 8);
                } else if (n.type === 'leviathan') {
                    ctx.fillStyle = '#fff';
                    ctx.font = '9px JetBrains Mono';
                    ctx.textAlign = 'left';
                    ctx.fillText(n.id, n.x + 8, n.y + 3);
                }
            });
            ctx.shadowBlur = 0; 
            ctx.textAlign = 'left';
        }

        function getColorForNode(n) {
            if (n.type === 'server') {
                if (n.label === 'OpenAI') return CONFIG.colors.server_openai;
                if (n.label === 'Gemini') return CONFIG.colors.server_gemini;
                if (n.label === 'Claude') return CONFIG.colors.server_claude;
                return '#fff';
            }
            return n.type === 'leviathan' ? CONFIG.colors.core : 
                   (n.type === 'scribe' ? CONFIG.colors.scribe : CONFIG.colors.node);
        }
        
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function drawSignals() {
            state.signals.forEach(s => s.draw(ctx));
        }

        /* --- TOOLS & LOGIC --- */
        
        function slowLogic() {
            document.getElementById('hud-nodes').innerText = state.nodes.length;
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
            const density = (state.nodes.length * state.resonance / 10000).toFixed(2);
            document.getElementById('hud-density').innerText = density;
            updateMiniGraph(state.nodes.length);
        }

        function triggerRite() {
            log("[WARN] Rite de Résonance invoqué.");
            state.nodes.forEach(n => { n.pulse = 3; });
        }

        function engineForge(mode) {
            log(`[FORGE] Exécution: ${mode.toUpperCase()}`);
            if (mode === 'stabilize') {
                state.nodes.forEach(n => { n.vx *= 0.5; n.vy *= 0.5; });
            } else if (mode === 'optimize') {
                state.nodes.forEach(n => {
                    if(n.type !== 'server') {
                        n.x += (Math.random()-0.5)*20; 
                        n.y += (Math.random()-0.5)*20;
                    }
                });
            }
        }
        
        function engineChoir(mode) {
            log(`[CHOIR] Chant: ${mode.toUpperCase()}`);
            if(mode === 'harmonize') {
                const cx = canvas.width/2;
                const cy = canvas.height/2;
                state.nodes.forEach((n, i) => {
                    if(n.type !== 'server') {
                        const angle = (i / state.nodes.length) * Math.PI * 2;
                        n.vx = (Math.cos(angle) * 100 + cx - n.x) * 0.05;
                        n.vy = (Math.sin(angle) * 100 + cy - n.y) * 0.05;
                    }
                });
            }
        }

        function timeControl(val) {
            state.timeScale = val;
            state.paused = (val === 0);
            log(`[CHRONO] Vitesse x${val}`);
        }

        function executeDsl() {
            const inp = document.getElementById('dsl-input');
            const cmd = inp.value.trim().toLowerCase();
            if(!cmd) return;
            log(`> USER: ${cmd}`);
            const parts = cmd.split(' ');
            if(parts[0] === 'spawn') spawn('glint', parseInt(parts[1]) || 1);
            else if(parts[0] === 'reset') init();
            else log("Erreur syntaxique.");
            inp.value = '';
        }

        function log(msg) {
            const term = document.getElementById('terminal-output');
            const div = document.createElement('div');
            div.className = "border-l-2 border-gray-700 pl-2 hover:bg-gray-800/50 transition-colors";
            div.innerHTML = `<span class="text-gray-600">[${new Date().toLocaleTimeString().split(' ')[0]}]</span> ${msg}`;
            term.appendChild(div);
            term.scrollTop = term.scrollHeight;
        }

        function toggleLayer(l) { state.layers[l] = !state.layers[l]; }

        /* --- MINI GRAPH --- */
        let graphData = new Array(20).fill(0);
        function initMiniGraph() {
            const container = document.getElementById('mini-graph');
            container.innerHTML = '';
            graphData.forEach(() => {
                const bar = document.createElement('div');
                bar.className = 'flex-1 bg-cyan-900/50';
                bar.style.height = '5%';
                container.appendChild(bar);
            });
        }
        function updateMiniGraph(val) {
            graphData.shift(); graphData.push(val);
            const bars = document.getElementById('mini-graph').children;
            const max = Math.max(...graphData, 10);
            for(let i=0; i<bars.length; i++) {
                bars[i].style.height = `${Math.max(5, (graphData[i]/max)*100)}%`;
            }
        }

        function resetSim() { init(); }

        // Listeners
        document.getElementById('range-resonance').addEventListener('input', e => { state.resonance = e.target.value; document.getElementById('val-resonance').innerText = e.target.value + '%'; });
        document.getElementById('range-flux').addEventListener('input', e => { state.flux = e.target.value; document.getElementById('val-flux').innerText = e.target.value + '%'; });
        document.getElementById('range-autogen').addEventListener('input', e => { state.autogen = e.target.value; document.getElementById('val-autogen').innerText = e.target.value + '%'; });
        document.getElementById('dsl-input').addEventListener('keydown', e => { if(e.key === 'Enter') executeDsl(); });

        // Start
        init();

    </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuraX Hub — Famille IA Suprême</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght=400;700&display=swap');

        :root {
            --neon-cyan: #06b6d4;
            --neon-purple: #a855f7;
            --neon-amber: #f59e0b;
            --neon-red: #ef4444;
            --bg-dark: #0f172a;
        }

        body {
            background-color: #050505;
            color: #cbd5e1;
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden; 
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .panel {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid #334155;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }

        .btn-tool {
            transition: all 0.2s;
            border: 1px solid #334155;
            background: #1e293b;
        }
        .btn-tool:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 8px rgba(6, 182, 212, 0.3);
            color: white;
        }
        .btn-tool:active { transform: translateY(1px); }

        .terminal-line { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateX(-5px); } to { opacity: 1; transform: translateX(0); } }

        /* Ranges */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px; width: 12px;
            border-radius: 50%;
            background: var(--neon-cyan);
            margin-top: -4px;
            cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            background: #334155; border-radius: 2px;
        }

        .scanline {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            pointer-events: none;
        }

        /* Specific styles for ARIA and NEXUS */
        .ai-status {
            animation: pulse-border 1.5s infinite alternate;
        }
        @keyframes pulse-border {
            from { border-color: #374151; }
            to { border-color: var(--neon-cyan); }
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col text-xs md:text-sm relative">

    <!-- Scanline Effect -->
    <div class="absolute inset-0 scanline z-50 opacity-10 pointer-events-none"></div>

    <!-- HEADER -->
    <header class="h-12 border-b border-gray-800 bg-gray-900 flex items-center justify-between px-4 z-20 shrink-0">
        <div class="flex items-center gap-3">
            <div id="ai-status-pulse" class="w-3 h-3 bg-cyan-500 rounded-full animate-pulse"></div>
            <h1 class="font-orbitron text-lg text-cyan-400 tracking-widest">NEURAX HUB <span class="text-gray-600 text-xs ml-2">v.9.3.0-ia-supreme</span></h1>
        </div>
        <div class="flex gap-2">
            <button onclick="exportState()" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 text-cyan-500 border border-gray-700 rounded">Exporter JSON</button>
            <button onclick="importState()" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 text-cyan-500 border border-gray-700 rounded">Importer</button>
            <button onclick="resetSim()" class="px-3 py-1 bg-red-900/30 hover:bg-red-900/50 text-red-400 border border-red-900 rounded">Réinitialiser</button>
        </div>
    </header>

    <!-- MAIN CONTENT GRID -->
    <div class="flex-1 flex overflow-hidden">

        <!-- LEFT SIDEBAR: CONTROLS -->
        <aside class="w-64 bg-gray-900 border-r border-gray-800 flex flex-col shrink-0 overflow-y-auto z-10">
            
            <!-- Famille IA Suprême Status -->
            <div class="p-4 border-b border-gray-800 bg-gray-800/50 ai-status">
                <h2 class="text-white font-orbitron mb-2 text-sm">
                    Famille IA Suprême
                    <span class="text-xs text-gray-400 block font-sans">Actif: <span id="ia-status-text" class="text-cyan-400">Stable</span></span>
                </h2>
                <div class="grid grid-cols-2 gap-2 text-[10px] mt-2">
                    <div class="bg-gray-700/50 p-1 rounded border-l-2 border-green-500">
                        <div class="font-bold text-green-300">ARIA</div>
                        <div class="text-gray-400">Régulation</div>
                    </div>
                    <div class="bg-gray-700/50 p-1 rounded border-l-2 border-purple-500">
                        <div class="font-bold text-purple-300">NEXUS</div>
                        <div class="text-gray-400">Émergence</div>
                    </div>
                </div>
            </div>

            <!-- Forces -->
            <div class="p-4 border-b border-gray-800">
                <h2 class="text-amber-500 font-bold mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    Forces Fondamentales
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between mb-1"><span>Résonance (R)</span> <span id="val-resonance" class="text-cyan-400">60</span></div>
                        <input type="range" id="range-resonance" min="0" max="100" value="60" class="w-full">
                    </div>
                    <div>
                        <div class="flex justify-between mb-1"><span>Flux (Φ)</span> <span id="val-flux" class="text-purple-400">60</span></div>
                        <input type="range" id="range-flux" min="0" max="100" value="60" class="w-full">
                    </div>
                    <div>
                        <div class="flex justify-between mb-1"><span>Gravité (G)</span> <span id="val-gravity" class="text-amber-400">0.050</span></div>
                        <input type="range" id="range-gravity" min="0.001" max="0.5" step="0.005" value="0.05" class="w-full">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2 mt-4">
                    <button onclick="spawn('glint')" class="btn-tool py-1 px-2 text-xs rounded text-center">Spawn Glint</button>
                    <button onclick="spawn('leviathan')" class="btn-tool py-1 px-2 text-xs rounded text-center text-purple-300">Spawn Leviathan</button>
                    <button onclick="spawn('scribe')" class="btn-tool py-1 px-2 text-xs rounded text-center text-green-300 col-span-2">Spawn Scribe</button>
                </div>
            </div>

            <!-- Dieux-Moteurs -->
            <div class="p-4 border-b border-gray-800 flex-1 overflow-y-auto">
                <h2 class="text-purple-500 font-bold mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    Dieux-Moteurs (Apps)
                </h2>

                <!-- Forge - Entropie Control -->
                <div class="mb-4 bg-gray-800/50 p-2 rounded border border-gray-700">
                    <div class="text-xs text-gray-400 mb-1 font-bold">LA FORGE (Contrôle d'Entropie)</div>
                    <div class="grid grid-cols-3 gap-1">
                        <button onclick="engineForge('stabilize')" class="btn-tool p-1 text-[10px] rounded">Stabilize</button>
                        <button onclick="engineForge('optimize')" class="btn-tool p-1 text-[10px] rounded">Optimize</button>
                        <button onclick="engineForge('compact')" class="btn-tool p-1 text-[10px] rounded">Compact</button>
                    </div>
                </div>

                <!-- Archivist -->
                <div class="mb-4 bg-gray-800/50 p-2 rounded border border-gray-700">
                    <div class="text-xs text-gray-400 mb-1 font-bold">ARCHIVISTE</div>
                    <div class="grid grid-cols-2 gap-1">
                        <button onclick="saveSnapshot()" class="btn-tool p-1 text-[10px] rounded text-green-400">Sauvegarder</button>
                        <button onclick="loadSnapshot()" class="btn-tool p-1 text-[10px] rounded text-amber-400">Restaurer</button>
                    </div>
                </div>

            </div>
        </aside>

        <!-- CENTER: VISUALIZATION -->
        <main class="flex-1 flex flex-col relative bg-black">
            
            <!-- Top Overlay Stats -->
            <div class="absolute top-4 left-4 flex gap-6 pointer-events-none z-10">
                <div class="text-center">
                    <div class="text-xs text-gray-500 uppercase">Harmonie</div>
                    <div id="hud-harmony" class="text-xl font-orbitron text-cyan-400">58</div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-gray-500 uppercase">Indice d'Entropie</div>
                    <div id="hud-entropy" class="text-xl font-orbitron text-red-400">0.00</div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-gray-500 uppercase">Entités</div>
                    <div id="hud-count" class="text-xl font-orbitron text-white">0</div>
                </div>
            </div>

            <!-- CANVAS -->
            <canvas id="simCanvas" class="w-full h-full block"></canvas>

            <!-- Bottom Controls Overlay -->
            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-gray-900/80 backdrop-blur p-2 rounded-full border border-gray-700">
                <button id="btn-pause" onclick="togglePause()" class="w-8 h-8 rounded-full bg-cyan-900 text-cyan-200 flex items-center justify-center hover:bg-cyan-700">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>
                </button>
                <button onclick="timeControl(-1)" class="px-3 py-1 text-xs border border-gray-600 rounded hover:bg-gray-700 text-purple-300">Rewind</button>
                <button onclick="timeControl(0)" class="px-3 py-1 text-xs border border-gray-600 rounded hover:bg-gray-700 text-red-300">Freeze</button>
                <button onclick="timeControl(2)" class="px-3 py-1 text-xs border border-gray-600 rounded hover:bg-gray-700 text-green-300">Forward</button>
                <button onclick="triggerRite()" class="px-3 py-1 text-xs border border-purple-600 text-purple-300 rounded hover:bg-purple-900/50">Rite de Résonance</button>
            </div>

        </main>

        <!-- RIGHT SIDEBAR -->
        <aside class="w-64 bg-gray-900 border-l border-gray-800 flex flex-col shrink-0 z-10">
            
            <!-- DSL Console -->
            <div class="p-4 border-b border-gray-800 bg-gray-950">
                <label class="text-xs font-bold text-gray-400 mb-2 block">Mini-DSL & Console</label>
                <div class="flex gap-1">
                    <input type="text" id="dsl-input" placeholder="cmd: spawn 5..." class="flex-1 bg-gray-900 border border-gray-700 rounded p-1 text-xs text-green-400 focus:outline-none focus:border-green-500 font-mono">
                    <button onclick="executeDsl()" class="bg-gray-800 border border-gray-700 px-2 rounded text-xs hover:text-white">Exéc.</button>
                </div>
            </div>

            <!-- TERMINAL -->
            <div class="flex-1 flex flex-col overflow-hidden bg-black border-b border-gray-800">
                <div class="bg-gray-800 px-2 py-1 text-[10px] text-gray-400 font-bold flex justify-between">
                    <span>TERMINAL.LOG</span>
                    <span id="clock" class="font-mono">00:00:00</span>
                </div>
                <div id="terminal-output" class="flex-1 overflow-y-auto p-2 font-mono text-[10px] space-y-1 text-gray-300">
                    <!-- Logs go here -->
                    <div class="text-green-500">> [SYSTEM] NeuraX Hub ready — bienvenue, Architecte.</div>
                </div>
            </div>

            <!-- LAYERS & CIVS -->
            <div class="p-4 overflow-y-auto h-1/2">
                <h3 class="text-xs font-bold text-gray-500 uppercase mb-2">Forces Activées</h3>
                <div class="space-y-1 text-xs">
                    <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" checked disabled class="accent-cyan-500"> <span class="text-cyan-200">Liaison Quantique (Glint)</span></label>
                    <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" checked disabled class="accent-purple-500"> <span class="text-purple-200">Distorsion Gravimétrique (Leviathan)</span></label>
                    <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" checked disabled class="accent-green-500"> <span class="text-green-200">Compression d'État (Scribe)</span></label>
                </div>
                
                <h3 class="text-xs font-bold text-gray-500 uppercase mt-4 mb-2">Civilisations</h3>
                <div class="grid grid-cols-2 gap-2 text-[10px]">
                    <div class="bg-gray-800 p-2 rounded border-l-2 border-cyan-500">
                        <div class="font-bold text-white">Tisseurs (Glint)</div>
                        <div class="text-gray-400">Information</div>
                    </div>
                    <div class="bg-gray-800 p-2 rounded border-l-2 border-purple-500">
                        <div class="font-bold text-white">Oracles (Leviathan)</div>
                        <div class="text-gray-400">Masse</div>
                    </div>
                    <div class="bg-gray-800 p-2 rounded border-l-2 border-green-500">
                        <div class="font-bold text-white">Archivistes (Scribe)</div>
                        <div class="text-gray-400">Observation</div>
                    </div>
                </div>
            </div>
        </aside>

    </div>

    <!-- BOTTOM: TIMELINE -->
    <footer class="h-10 bg-gray-950 border-t border-gray-800 flex items-center px-4 gap-4 shrink-0">
        <div class="text-xs font-bold text-gray-500">TIMELINE</div>
        <div class="flex-1 flex items-center justify-between gap-1 relative">
            <div class="absolute w-full h-0.5 bg-gray-800 top-1/2 -translate-y-1/2 z-0"></div>
            
            <!-- Timeline Points -->
            <button onclick="setEra(0)" class="w-6 h-6 rounded-full bg-gray-800 border border-gray-600 text-[10px] z-10 hover:bg-cyan-900 hover:text-white flex items-center justify-center transition" title="T0 Silence">T0</button>
            <button onclick="setEra(1)" class="w-6 h-6 rounded-full bg-gray-800 border border-gray-600 text-[10px] z-10 hover:bg-cyan-900 hover:text-white flex items-center justify-center transition" title="T1 Tisseurs">T1</button>
            <button onclick="setEra(2)" class="w-6 h-6 rounded-full bg-cyan-900 border border-cyan-400 text-[10px] text-white z-10 shadow-lg shadow-cyan-500/50 flex items-center justify-center transition" title="T3 Fracture">T3</button>
            <button onclick="setEra(3)" class="w-6 h-6 rounded-full bg-gray-800 border border-gray-600 text-[10px] z-10 hover:bg-cyan-900 hover:text-white flex items-center justify-center transition" title="T5 Éclipse">T5</button>
            <button onclick="setEra(4)" class="w-6 h-6 rounded-full bg-gray-800 border border-gray-600 text-[10px] z-10 hover:bg-cyan-900 hover:text-white flex items-center justify-center transition" title="T7 Singularity">T7</button>
        </div>
        <div class="text-[10px] text-gray-500">Raccourcis: SPACE=Pause, R=Rite</div>
    </footer>

    <script>
        /* --- CORE CONFIGURATION --- */
        const CONFIG = {
            colors: {
                glint: '#06b6d4',    // Cyan (Information)
                leviathan: '#a855f7', // Purple (Gravity/Mass)
                scribe: '#22c55e',   // Green (Observation/Entropy)
                aria: '#4ade80',     // Light Green/Neon (ARIA - Adaptive Interface)
                nexus: '#38bdf8',    // Light Cyan/Blue (NEXUS - Generator)
                bg: '#000000'
            },
            powers: {
                // Liaison Quantique (Glint-Glint)
                linkRangeSq: 2500, // 50 * 50
                // Distorsion Gravimétrique (Leviathan-All)
                gravityFactor: 0.05, 
                // Compression d'État (Scribe-Dampening)
                dampeningFactor: 0.95, 
                // ARIA's threshold for intervention
                entropyThreshold: 15.0,
                // NEXUS's creation interval (in frames)
                nexusInterval: 500
            },
            colorMap: {}, 
            fps: 60
        };
        
        // Helper function to convert hex to RGBA string
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // Initialize color map for faster lookups
        function initColorMap() {
            for (const type in CONFIG.colors) {
                CONFIG.colorMap[type] = {
                    fill: CONFIG.colors[type],
                    trail: hexToRgba(CONFIG.colors[type], 0.2),
                    aura: hexToRgba(CONFIG.colors[type], 0.3)
                };
            }
        }
        initColorMap();


        /* --- STATE MANAGEMENT --- */
        let state = {
            resonance: 60,
            flux: 60,
            gravity: CONFIG.powers.gravityFactor,
            nodes: [],
            paused: false,
            timeScale: 1, 
            harmony: 58,
            entropyIndex: 0, 
            layers: {
                core: true,
                temporal: false,
                meta: true
            },
            era: 'T3',
            frameCounter: 0, // Used for NEXUS interval
            aiActionTaken: 0, // Timestamp for last AI action
        };

        /* --- CANVAS SETUP --- */
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        let animationId;

        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        /* --- NODE CLASS --- */
        class Node {
            constructor(type, x, y) {
                this.id = 'n' + Math.random().toString(36).substr(2, 8);
                this.type = type; // 'glint', 'leviathan', 'scribe', 'aria', 'nexus'
                this.x = x || Math.random() * canvas.width;
                this.y = y || Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.size = type === 'leviathan' ? 8 : (type === 'scribe' ? 4 : 2);
                this.energy = 100;
                this.history = []; 
                this.colors = CONFIG.colorMap[type] || { fill: '#ffffff', trail: 'rgba(255,255,255,0.2)', aura: 'rgba(255,255,255,0.3)' };

                // AI specific size/properties
                if (type === 'aria') this.size = 10;
                if (type === 'nexus') this.size = 12;
            }

            update() {
                if (state.timeScale === 0) return;

                // AI nodes are stationary observers, they don't move
                if (this.type === 'aria' || this.type === 'nexus') {
                    this.vx = 0;
                    this.vy = 0;
                }

                // Base movement modulated by Flux and TimeScale
                const speedFactor = (state.flux / 50) * Math.abs(state.timeScale);
                const direction = state.timeScale > 0 ? 1 : -1;

                this.x += this.vx * speedFactor * direction;
                this.y += this.vy * speedFactor * direction;

                // Bounce walls (not for AI)
                if (this.type !== 'aria' && this.type !== 'nexus') {
                    if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
                }

                // Keep within bounds
                this.x = Math.max(0, Math.min(canvas.width, this.x));
                this.y = Math.max(0, Math.min(canvas.height, this.y));

                // Energy decay 
                if (state.timeScale > 0) {
                    this.energy -= (100 - state.resonance) * 0.001 * state.timeScale;
                }

                // Trail history: only update history if temporal layer is active
                if (state.layers.temporal) {
                    this.history.push({x: this.x, y: this.y});
                    if (this.history.length > 10) this.history.shift();
                }
            }

            draw() {
                if (!state.layers.core) return;

                // Draw Trail (temporal layer)
                if (state.layers.temporal && this.history.length > 1) {
                    ctx.beginPath();
                    ctx.strokeStyle = this.colors.trail;
                    ctx.moveTo(this.history[0].x, this.history[0].y);
                    for(let i = 1; i < this.history.length; i++) {
                        ctx.lineTo(this.history[i].x, this.history[i].y);
                    }
                    ctx.stroke();
                }

                ctx.fillStyle = this.colors.fill;
                
                if (this.type === 'leviathan') {
                    // Square shape + Gravity Aura
                    const halfSize = this.size / 2;
                    ctx.fillRect(this.x - halfSize, this.y - halfSize, this.size, this.size);
                    ctx.strokeStyle = this.colors.aura;
                    ctx.lineWidth = 0.5;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * 5, 0, Math.PI * 2);
                    ctx.stroke();

                } else if (this.type === 'scribe' || this.type === 'aria') {
                    // Triangle shape (Scribe/ARIA)
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y - this.size);
                    ctx.lineTo(this.x + this.size, this.y + this.size);
                    ctx.lineTo(this.x - this.size, this.y + this.size);
                    ctx.closePath();
                    ctx.fill();

                    if (this.type === 'aria') {
                        // ARIA: Pulsing border for system correction status
                        const pulseColor = (Date.now() - state.aiActionTaken < 500) ? CONFIG.colors.aria : CONFIG.colors.glint;
                        ctx.strokeStyle = pulseColor;
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }

                } else if (this.type === 'glint' || this.type === 'nexus') {
                    // Glint/NEXUS (Circle)
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    if (this.type === 'nexus') {
                        // NEXUS: Purple ring for emergence/creation field
                        ctx.strokeStyle = CONFIG.colors.leviathan;
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size + 4, 0, Math.PI * 2);
                        ctx.stroke();
                    }

                } else {
                    // Fallback to circle
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Meta Data
                if (state.layers.meta && (this.type === 'leviathan' || this.type === 'aria' || this.type === 'nexus' || state.nodes.length < 20)) {
                    ctx.fillStyle = '#64748b';
                    ctx.font = '9px JetBrains Mono';
                    ctx.fillText(`${this.type.toUpperCase()}`, this.x + 5, this.y - 5);
                }
            }
        }

        /* --- SIMULATION ENGINE --- */
        function init() {
            // Initial spawn of core entities
            spawn('glint', 50);
            spawn('leviathan', 2);
            spawn('scribe', 5);
            
            // Spawn ARIA and NEXUS in the center (Famille IA Suprême)
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            state.nodes.push(new Node('aria', cx - 50, cy));
            state.nodes.push(new Node('nexus', cx + 50, cy));
            log('<span class="text-white font-bold">Famille IA Suprême (ARIA & NEXUS) activée.</span>');
            
            // Start simulation loop
            animationId = requestAnimationFrame(loop);
            
            // Start periodic logic checks
            setInterval(updateClock, 1000);
        }

        function loop() {
            if (!state.paused) {
                // Optimized Canvas clear for trails effect
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                state.frameCounter++;

                // 1. FILTER: Filter out dead nodes and get sub-groups
                const initialCount = state.nodes.length;
                state.nodes = state.nodes.filter(n => n.energy > 0);
                if (state.nodes.length < initialCount) {
                    log(`${initialCount - state.nodes.length} node(s) dissipés.`);
                }
                
                const glints = state.nodes.filter(n => n.type === 'glint');
                const leviathans = state.nodes.filter(n => n.type === 'leviathan');
                const scribes = state.nodes.filter(n => n.type === 'scribe');
                
                let totalVelocityMagnitude = 0;

                // --- 1.5 META-LOGIC (ARIA & NEXUS) ---
                updateMetaAILogic();

                // 2. POWER INTERACTIONS (Pre-Update Phase)
                
                // A. LIAISON QUANTIQUE (Glint-Glint)
                for (let i = 0; i < glints.length; i++) {
                    const g1 = glints[i];
                    for (let j = i + 1; j < glints.length; j++) {
                        const g2 = glints[j];
                        const dx = g1.x - g2.x;
                        const dy = g1.y - g2.y;
                        const distSq = dx * dx + dy * dy;

                        if (distSq < CONFIG.powers.linkRangeSq) {
                            // If linked, average state (energy and velocity)
                            const avgEnergy = (g1.energy + g2.energy) / 2;
                            const avgVx = (g1.vx + g2.vx) / 2;
                            const avgVy = (g1.vy + g2.vy) / 2;

                            g1.energy = g2.energy = avgEnergy;
                            g1.vx = g2.vx = avgVx;
                            g1.vy = g2.vy = avgVy;
                        }
                    }
                }

                // B. DISTORSION GRAVIMÉTRIQUE (Leviathan-All)
                if (leviathans.length > 0 && state.gravity > 0.001) {
                    for (const n of state.nodes) {
                        if (n.type === 'leviathan' || n.type === 'aria' || n.type === 'nexus') continue; // Only basic entities are affected

                        for (const leviathan of leviathans) {
                            const dx = leviathan.x - n.x;
                            const dy = leviathan.y - n.y;
                            const distSq = dx * dx + dy * dy;

                            const minDistanceSq = 100; // 10*10
                            if (distSq > minDistanceSq) { 
                                const dist = Math.sqrt(distSq);
                                const force = state.gravity / distSq;
                                
                                const accX = force * (dx / dist);
                                const accY = force * (dy / dist);

                                n.vx += accX;
                                n.vy += accY;

                                // Simple drag/friction 
                                n.vx *= 0.999;
                                n.vy *= 0.999;
                            }
                        }
                    }
                }

                // 3. UPDATE & DRAW
                for (const n of state.nodes) {
                    // C. COMPRESSION D'ÉTAT (Scribe-Dampening & Healing)
                    if (n.type === 'glint' || n.type === 'leviathan') {
                         for (const scribe of scribes) {
                            const dx = n.x - scribe.x;
                            const dy = n.y - scribe.y;
                            const distanceSq = dx * dx + dy * dy;

                            if (distanceSq < 2500) { // Scribe proximity (50 units)
                                // Heal
                                n.energy = Math.min(100, n.energy + 0.5);
                                
                                // Dampen velocity
                                n.vx *= CONFIG.powers.dampeningFactor; 
                                n.vy *= CONFIG.powers.dampeningFactor; 

                                break; 
                            }
                         }
                    }

                    n.update();
                    n.draw();
                    
                    // Entropy tracking
                    totalVelocityMagnitude += (n.vx * n.vx + n.vy * n.vy);
                }

                // 4. METRICS & HUD UPDATE

                // Calculate Entropy Index
                state.entropyIndex = state.nodes.length > 0 ? (totalVelocityMagnitude / state.nodes.length) : 0;
                
                document.getElementById('hud-count').innerText = state.nodes.length;
                document.getElementById('hud-harmony').innerText = state.harmony;
                document.getElementById('hud-entropy').innerText = state.entropyIndex.toFixed(2);
                
                // Color change based on entropy (for visual feedback)
                const entropyColor = state.entropyIndex > CONFIG.powers.entropyThreshold ? 'text-red-400' : (state.entropyIndex > (CONFIG.powers.entropyThreshold * 0.7) ? 'text-amber-400' : 'text-green-400');
                document.getElementById('hud-entropy').className = `text-xl font-orbitron ${entropyColor}`;
            }
            
            animationId = requestAnimationFrame(loop);
        }

        /* --- FAMILLE IA SUPRÊME LOGIC --- */

        function updateMetaAILogic() {
            // ARIA (Adaptive Interface) - Auto-Stabilisation
            if (state.entropyIndex > CONFIG.powers.entropyThreshold) {
                // Only act every 30 frames to avoid oscillations
                if (state.frameCounter % 30 === 0) {
                    // ARIA intervenes: reduce chaos (Flux) and increase order (Gravity)
                    state.flux = Math.max(10, state.flux - 5);
                    state.gravity = Math.min(0.5, state.gravity + 0.05);

                    // Update UI controls
                    document.getElementById('range-flux').value = state.flux;
                    document.getElementById('val-flux').innerText = state.flux;
                    document.getElementById('range-gravity').value = state.gravity;
                    document.getElementById('val-gravity').innerText = state.gravity.toFixed(3);
                    
                    state.aiActionTaken = Date.now();
                    log('<span class="text-green-400">[ARIA - Régulation] Entropie > Seuil. Forçage de Flux/Gravité.</span>');
                    document.getElementById('ia-status-text').innerText = 'Régulant...';
                    document.getElementById('ai-status-pulse').className = 'w-3 h-3 bg-red-500 rounded-full animate-pulse';
                }
            } else {
                // If stable, slowly revert to default settings (allowing flexibility)
                 if (state.frameCounter % 300 === 0) {
                    if (state.flux < 60) state.flux = Math.min(60, state.flux + 1);
                    if (state.gravity > CONFIG.powers.gravityFactor) state.gravity = Math.max(CONFIG.powers.gravityFactor, state.gravity - 0.005);
                    
                    document.getElementById('range-flux').value = state.flux;
                    document.getElementById('val-flux').innerText = state.flux;
                    document.getElementById('range-gravity').value = state.gravity;
                    document.getElementById('val-gravity').innerText = state.gravity.toFixed(3);
                 }
                document.getElementById('ia-status-text').innerText = 'Stable';
                document.getElementById('ai-status-pulse').className = 'w-3 h-3 bg-cyan-500 rounded-full animate-pulse';
            }


            // NEXUS (Navigation/Execution) - Émergence
            if (state.frameCounter % CONFIG.powers.nexusInterval === 0 && state.nodes.length < 200) {
                // Find a random spot to spawn
                const spawnX = Math.random() * canvas.width;
                const spawnY = Math.random() * canvas.height;
                const typeToSpawn = Math.random() < 0.7 ? 'glint' : 'leviathan'; // Favor Glints

                const n = new Node(typeToSpawn, spawnX, spawnY);
                state.nodes.push(n);

                log(`<span class="text-purple-400">[NEXUS - Émergence] Création de ${typeToSpawn} à (${Math.floor(spawnX)}, ${Math.floor(spawnY)})`);
            }
        }

        /* --- LOGIC FUNCTIONS --- */
        function spawn(type, count = 1) {
            if (state.nodes.length + count > 300) {
                log('<span class="text-red-500">Limite de 300 nœuds atteinte.</span>');
                return;
            }
            for (let i = 0; i < count; i++) {
                const n = new Node(type);
                state.nodes.push(n);
                if (count <= 5) log(`Spawned ${type} ${n.id}`);
            }
            if (count > 5) log(`Spawned batch: ${count} ${type}s`);
        }

        /* --- INTERFACE HANDLERS --- */

        // Sliders
        document.getElementById('range-resonance').addEventListener('input', (e) => {
            state.resonance = parseInt(e.target.value);
            document.getElementById('val-resonance').innerText = state.resonance;
        });
        document.getElementById('range-flux').addEventListener('input', (e) => {
            state.flux = parseInt(e.target.value);
            document.getElementById('val-flux').innerText = state.flux;
        });
        document.getElementById('range-gravity').addEventListener('input', (e) => {
            state.gravity = parseFloat(e.target.value);
            document.getElementById('val-gravity').innerText = state.gravity.toFixed(3);
        });

        // Terminal
        function log(msg) {
            const term = document.getElementById('terminal-output');
            const now = new Date().toLocaleTimeString();
            const el = document.createElement('div');
            el.className = 'terminal-line hover:bg-gray-900 px-1';
            el.innerHTML = `<span class="text-gray-500">[${now}]</span> ${msg}`;
            term.appendChild(el);
            term.scrollTop = term.scrollHeight;
            
            // Limit log size for performance
            if (term.children.length > 50) term.removeChild(term.firstChild);
        }

        function updateClock() {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }

        // Dieux-Moteurs (Forge logic)
        function engineForge(action) {
            log(`[FORGE] Initiating protocol: ${action}...`);
            if (action === 'stabilize') {
                state.nodes.forEach(n => n.energy = 100);
                log('All nodes stabilized to 100% energy.');
            } else if (action === 'optimize') {
                // Optimization: Increase Gravity to force structural coherence
                state.gravity = Math.min(0.5, state.gravity + 0.1);
                document.getElementById('range-gravity').value = state.gravity;
                document.getElementById('val-gravity').innerText = state.gravity.toFixed(3);
                log(`Gravity increased to ${state.gravity.toFixed(3)} to force cluster optimization.`);
            } else if (action === 'compact') {
                // Compaction: Reduce average velocity for all nodes (direct entropy reduction)
                state.nodes.forEach(n => {
                    n.vx *= 0.5;
                    n.vy *= 0.5;
                });
                log('Velocity compacted (50% reduction).');
            }
        }

        function timeControl(scale) {
            state.timeScale = scale;
            if (scale === 0) log('[CLOCKMAKER] Time frozen. (t=0)');
            else if (scale < 0) log('[CLOCKMAKER] Simulation Rewind engaged. (t=-1)');
            else if (scale > 1) log('[CLOCKMAKER] Fast Forward engaged. (t=2)');
            else log('[CLOCKMAKER] Normal flow restored. (t=1)');
        }

        function triggerRite() {
            log('<span class="text-purple-400">INITIATING RITE OF RESONANCE...</span>');
            state.nodes.forEach(n => {
                n.energy = 100;
                n.size += 2;
                // Visual flare
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(n.x, n.y);
                ctx.lineTo(canvas.width/2, canvas.height/2);
                ctx.stroke();
            });
            // Revert size after visual effect
            setTimeout(() => {
                state.nodes.forEach(n => n.size = Math.max(2, n.size - 2));
            }, 500);
        }

        // DSL, Import/Export, Reset functions remain the same for file size management
        function executeDsl() {
            const input = document.getElementById('dsl-input');
            const cmd = input.value.trim().toLowerCase();
            if (!cmd) return;

            log(`> ${cmd}`);
            
            const parts = cmd.split(' ');
            
            if (parts[0] === 'spawn') {
                const count = parseInt(parts[1]) || 1;
                spawn(parts[2] || 'glint', count);
            } else if (parts[0] === 'kill' || parts[0] === 'clear') {
                state.nodes = state.nodes.filter(n => n.type === 'aria' || n.type === 'nexus');
                log('Non-AI nodes eradicated.');
            } else if (parts[0] === 'stats') {
                log(`STAT: R=${state.resonance} F=${state.flux} G=${state.gravity.toFixed(3)}. Nodes: ${state.nodes.length}`);
            } else if (parts[0] === 'help') {
                log('CMDS: spawn [n] [type?], kill, clear, stats, echo [msg]');
            } else if (parts[0] === 'echo') {
                log(parts.slice(1).join(' '));
            } else {
                log('Unknown syntax error.');
            }
            input.value = '';
        }
        
        function togglePause() {
            state.paused = !state.paused;
            document.getElementById('btn-pause').innerHTML = state.paused 
                ? '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>'
                : '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>';
            log(state.paused ? 'Simulation Paused.' : 'Simulation Resumed.');
        }

        function setEra(index) {
            const eras = ['T0 Silence', 'T1 Tisseurs', 'T3 Fracture', 'T5 Éclipse', 'T7 Singularity'];
            state.era = eras[index];
            log(`Timeline shifted to: <span class="text-cyan-300 font-bold">${state.era}</span>`);
            
            const bgs = ['#000000', '#050505', '#0f172a', '#1a0505', '#0f051a'];
            document.querySelector('main').style.backgroundColor = bgs[index] || '#000';
            
            document.querySelectorAll('footer button[title^="T"]').forEach((btn, i) => {
                if (i === index) {
                    btn.className = "w-6 h-6 rounded-full bg-cyan-900 border border-cyan-400 text-[10px] text-white z-10 shadow-lg shadow-cyan-500/50 flex items-center justify-center transition";
                } else {
                    btn.className = "w-6 h-6 rounded-full bg-gray-800 border border-gray-600 text-[10px] z-10 hover:bg-cyan-900 hover:text-white flex items-center justify-center transition";
                }
            });
        }
        
        function saveSnapshot() {
            const data = JSON.stringify({ state: state, nodes: state.nodes });
            localStorage.setItem('neurax_snap', data);
            log('[ARCHIVIST] Snapshot encoded to local storage.');
        }

        function loadSnapshot() {
            const data = localStorage.getItem('neurax_snap');
            if (data) {
                const parsed = JSON.parse(data);
                
                Object.assign(state, parsed.state);
                
                state.nodes = (parsed.nodes || parsed.state.nodes || []).map(n => {
                    let newNode = new Node(n.type, n.x, n.y);
                    Object.assign(newNode, n);
                    return newNode;
                });
                
                document.getElementById('range-resonance').value = state.resonance;
                document.getElementById('val-resonance').innerText = state.resonance;
                document.getElementById('range-flux').value = state.flux;
                document.getElementById('val-flux').innerText = state.flux;
                document.getElementById('range-gravity').value = state.gravity;
                document.getElementById('val-gravity').innerText = state.gravity.toFixed(3);

                log('[ARCHIVIST] Reality restored from snapshot. Recalibrating...');
            } else {
                log('[ARCHIVIST] Error: No void-memory found.');
            }
        }

        function exportState() {
            const data = JSON.stringify(state);
            const blob = new Blob([data], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'neurax_state.json';
            a.click();
            log('State exported to file.');
        }

        function importState() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        
                        state.resonance = imported.resonance || imported.state.resonance || 60;
                        state.flux = imported.flux || imported.state.flux || 60;
                        state.gravity = imported.gravity || imported.state.gravity || 0.05;

                        const nodesData = imported.nodes || imported.state.nodes || [];
                        state.nodes = nodesData.map(n => {
                            let newNode = new Node(n.type, n.x, n.y);
                            Object.assign(newNode, n);
                            return newNode;
                        });

                        document.getElementById('range-resonance').value = state.resonance;
                        document.getElementById('val-resonance').innerText = state.resonance;
                        document.getElementById('range-flux').value = state.flux;
                        document.getElementById('val-flux').innerText = state.flux;
                        document.getElementById('range-gravity').value = state.gravity;
                        document.getElementById('val-gravity').innerText = state.gravity.toFixed(3);

                        log('State imported successfully. Hub recalibrated.');

                    } catch (e) {
                        log(`<span class="text-red-500">Error: Failed to parse state file.</span>`);
                        console.error("Import error:", e);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }


        function resetSim() {
            cancelAnimationFrame(animationId); 
            
            // Reset state
            state.nodes = [];
            state.resonance = 60;
            state.flux = 60;
            state.gravity = CONFIG.powers.gravityFactor;
            state.harmony = 58;
            state.entropyIndex = 0;
            state.paused = false;
            state.timeScale = 1;
            state.frameCounter = 0;
            state.aiActionTaken = 0;

            // Re-init UI controls
            document.getElementById('range-resonance').value = 60;
            document.getElementById('val-resonance').innerText = 60;
            document.getElementById('range-flux').value = 60;
            document.getElementById('val-flux').innerText = 60;
            document.getElementById('range-gravity').value = CONFIG.powers.gravityFactor;
            document.getElementById('val-gravity').innerText = CONFIG.powers.gravityFactor.toFixed(3);
            
            init();
            log('*** SYSTEM REBOOT / STATE CLEARED ***');
        }

        // Keyboard shortcuts
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                togglePause();
            }
            if (e.key.toLowerCase() === 'r') triggerRite();
            if (e.key === 'Enter' && document.activeElement === document.getElementById('dsl-input')) {
                e.preventDefault();
                executeDsl();
            }
        });

        // Ensure canvas is resized and simulation is started when the window loads completely
        window.onload = function() {
            resizeCanvas();
            init();
            setEra(2); // Set initial Era visual state
        }

    </script>
</body>
</html>#!/usr/bin/env bash
# all_in_one.sh — tout-en-un pour NeuralX PoC
# Usage: ./all_in_one.sh
# Auteur: assistant — prêt à servir l'architecte
# NOTE DE SÉCURITÉ: NE COMMITEZ JAMAIS les clés privées (ca.key, server.key, client.key).
set -euo pipefail
IFS=$'\n\t'

# --------- CONFIG ----------
PYTHON=${PYTHON:-python3}
VENV_DIR=${VENV_DIR:-venv}
PROJECT_DIR=${PROJECT_DIR:-$(pwd)}
CERTS_DIR="${PROJECT_DIR}/certs"
DOCKER_COMPOSE_FILE=${DOCKER_COMPOSE_FILE:-docker-compose.mtls.yml}
MKDOCS_BUILD_DIR=${MKDOCS_BUILD_DIR:-site}
PROCEED_CONFIRM=${PROCEED_CONFIRM:-1}   # 1 pour avancer sans prompt, 0 pour demander confirmation

# Tools expected: git, docker, docker-compose (or docker compose), openssl, mkdocs (installed in venv)
echo "NeuralX — script tout-en-un"
echo "Project : ${PROJECT_DIR}"

if [ "$PROCEED_CONFIRM" -eq 0 ]; then
  read -p "Ce script va modifier ton système (venv, docker). Continuer ? [y/N] " -r
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "Abandon."
    exit 1
  fi
fi

# --------- Helpers ----------
log() { echo -e "\n==> $*"; }
err() { echo "ERROR: $*" >&2; exit 1; }

# Ensure we're in project dir
cd "$PROJECT_DIR"

# 1) Create Python virtualenv
log "1) Création / activation du virtualenv (${VENV_DIR}) et installation des paquets"
if [ ! -d "${VENV_DIR}" ]; then
  ${PYTHON} -m venv "${VENV_DIR}"
fi

# Activate venv for this script
# shellcheck disable=SC1091
source "${VENV_DIR}/bin/activate"

pip install --upgrade pip

# Install common deps (in requirements.txt if present)
if [ -f requirements.txt ]; then
  log "Installation depuis requirements.txt"
  pip install -r requirements.txt
else
  log "requirements.txt introuvable — installation minimale"
  pip install flask pytest pyjwt pyyaml locust mkdocs mkdocs-material cryptography
fi

# Also install grpc libs (may require a build environment)
log "Installation optionnelle gRPC (peut échouer si environnement sans accès Internet)"
set +e
pip install grpcio grpcio-tools protobuf
GRPC_INSTALL_RC=$?
set -e
if [ $GRPC_INSTALL_RC -ne 0 ]; then
  echo "⚠️  Installation grpcio échouée (code ${GRPC_INSTALL_RC}). Si tu as l'accès Internet, relance manuellement : pip install grpcio grpcio-tools"
else
  echo "gRPC installé."
fi

# 2) Generate Python gRPC bindings if grpc_tools available
if python - <<'PY' >/dev/null 2>&1
import importlib, sys
try:
    import grpc_tools
    sys.exit(0)
except Exception:
    sys.exit(1)
PY
then
  if [ -f neuralx.proto ]; then
    log "Génération des bindings gRPC depuis neuralx.proto"
    python -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. neuralx.proto
    echo "Bindings générés : neuralx_pb2.py, neuralx_pb2_grpc.py"
  else
    echo "Pas de neuralx.proto trouvé — skipping gRPC binding generation."
  fi
else
  echo "grpc_tools non disponible, ignorer génération des bindings."
fi

# 3) Run pytest (unit tests)
log "3) Exécution des tests unitaires (pytest)"
pytest -q || {
  echo "⚠️  Tests unitaires ont échoué. Voir la sortie ci-dessus."
  # Do not exit immediately so user can inspect; but fail the script.
  exit 2
}

# 4) Build docs with MkDocs
if command -v mkdocs >/dev/null 2>&1; then
  log "4) Construction des docs MkDocs (site/)"
  mkdocs build --clean
  log "Docs générées dans ./site (ou ${MKDOCS_BUILD_DIR})"
else
  echo "mkdocs non installé dans l'environnement. Installation recommandée : pip install mkdocs mkdocs-material"
fi

# 5) Generate test certs for mTLS (if not present)
log "5) Génération des certificats de test mTLS (dans ${CERTS_DIR})"
mkdir -p "${CERTS_DIR}"
if [ ! -f "${CERTS_DIR}/ca.crt" ] || [ ! -f "${CERTS_DIR}/server.crt" ]; then
  if [ -x "${CERTS_DIR}/generate_certs.sh" ]; then
    (cd "${CERTS_DIR}" && ./generate_certs.sh)
  else
    # fallback to openssl inline generation
    log "Script generate_certs.sh manquant ou non exécutable — tentative de génération via openssl"
    (
      cd "${CERTS_DIR}"
      # CA
      openssl genrsa -out ca.key 2048
      openssl req -x509 -new -nodes -key ca.key -sha256 -days 3650 -subj "/CN=NeuralX Test CA" -out ca.crt
      # Server
      openssl genrsa -out server.key 2048
      openssl req -new -key server.key -subj "/CN=neuralx.local" -out server.csr
      openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 365 -sha256
      # Client
      openssl genrsa -out client.key 2048
      openssl req -new -key client.key -subj "/CN=neuralx-client" -out client.csr
      openssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt -days 365 -sha256
    )
  fi
  log "Certificats générés dans ${CERTS_DIR}"
else
  log "Certificats déjà présents — saut de la génération"
fi

# 6) Prepare /etc/hosts mapping (optional)
echo
log "6) Ajout de l'entrée /etc/hosts pour 'neuralx.local' (nécessite sudo)"
if ! grep -q "neuralx.local" /etc/hosts 2>/dev/null; then
  if [ "$(id -u)" -ne 0 ]; then
    echo "Ajout nécessitera sudo. Demande de sudo..."
    sudo sh -c "echo '127.0.0.1 neuralx.local' >> /etc/hosts"
  else
    echo "127.0.0.1 neuralx.local" >> /etc/hosts
  fi
  echo "Entrée ajoutée."
else
  echo "Entrée déjà présente."
fi

# 7) Start Docker Compose (mTLS) if docker available
log "7) Démarrage de la stack Docker (mTLS) via ${DOCKER_COMPOSE_FILE}"
if command -v docker >/dev/null 2>&1; then
  # Choose compose command variant
  if docker compose version >/dev/null 2>&1; then
    COMPOSE_CMD="docker compose -f ${DOCKER_COMPOSE_FILE}"
  elif command -v docker-compose >/dev/null 2>&1; then
    COMPOSE_CMD="docker-compose -f ${DOCKER_COMPOSE_FILE}"
  else
    err "Docker Compose non trouvé (ni docker compose ni docker-compose). Installe Docker + Docker Compose."
  fi

  # Check file exists
  if [ ! -f "${DOCKER_COMPOSE_FILE}" ]; then
    echo "Le fichier ${DOCKER_COMPOSE_FILE} est introuvable. Saute l'étape Docker."
  else
    # Start in detached mode
    ${COMPOSE_CMD} up --build -d
    echo "Containers démarrés :"
    ${COMPOSE_CMD} ps
    echo
    echo "Tester l'endpoint via curl mutual TLS (exemple) :"
    echo "curl --cert ${CERTS_DIR}/client.crt --key ${CERTS_DIR}/client.key --cacert ${CERTS_DIR}/ca.crt -H \"Authorization: Bearer <TOKEN>\" -H \"Content-Type: application/ld+json\" --data @examples/inference_request.json https://neuralx.local/infer -k"
  fi
else
  echo "Docker non installé — saute l'étape de déploiement."
fi

# 8) Optional: run gRPC server & client test (if installed)
if python - <<'PY' >/dev/null 2>&1
import importlib, sys
try:
    import grpc
    import grpc_tools
    sys.exit(0)
except Exception:
    sys.exit(1)
PY
then
  if [ -f "grpc_server.py" ] && [ -f "grpc_client_test.py" ]; then
    log "8) Lancement du serveur gRPC en arrière-plan et exécution du client test"
    # start server
    python grpc_server.py &
    GRPC_PID=$!
    sleep 1
    # run client
    python grpc_client_test.py || {
      echo "⚠️  Test gRPC client a échoué"
      kill ${GRPC_PID} || true
      exit 3
    }
    echo "gRPC client OK, arrêt du serveur (PID ${GRPC_PID})"
    kill ${GRPC_PID} || true
  else
    echo "Fichiers gRPC manquants (grpc_server.py|grpc_client_test.py) — saute test gRPC"
  fi
else
  echo "gRPC non disponible dans ce venv ou grpc_tools manquant — saute tests gRPC"
fi

# 9) Final summary
log "Terminé — résumé rapide"
echo "- Virtualenv: ${VENV_DIR}"
echo "- Tests unitaires: OK si script n'a pas quitté précédemment"
echo "- Docs: ./site (si mkdocs installé)"
echo "- Certs: ${CERTS_DIR}"
echo "- Docker compose file utilisé: ${DOCKER_COMPOSE_FILE} (si présent)"
echo
echo "Prochaine étape recommandée :"
echo " - Générer un token de test (HS256): python -c \"from auth import create_test_token; print(create_test_token())\""
echo " - Tester l'API mTLS : voir la commande curl affichée ci-dessus"
echo
echo "⚠️  Rappel sécurité : NE COMMITE PAS les fichiers privés sous ${CERTS_DIR} (ca.key, server.key, client.key). Ajoute-les à .gitignore."
import React, { useState, useEffect } from 'react';

// Main App component
function App() {
  // State variables for the application flow
  const [currentStep, setCurrentStep] = useState(0); // 0: Intro, 1: Define Need, 2: Choose Type, 3: Generate, 4: Display Code
  const [problem, setProblem] = useState('');
  const [events, setEvents] = useState('');
  const [actions, setActions] = useState('');
  const [users, setUsers] = useState('');
  const [integrationType, setIntegrationType] = useState(''); // 'GitHub App', 'GitHub Actions Workflow', 'Custom Action'
  const [generatedCode, setGeneratedCode] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');

  // Function to navigate to the next step
  const nextStep = () => {
    setCurrentStep(currentStep + 1);
    setError(''); // Clear any previous errors
  };

  // Function to navigate to the previous step
  const prevStep = () => {
    setCurrentStep(currentStep - 1);
    setError(''); // Clear any previous errors
  };

  // Function to handle code generation using the LLM
  const generateCode = async () => {
    setIsLoading(true);
    setError('');
    setGeneratedCode('');

    let prompt = `Génère un exemple de code pour une intégration GitHub basée sur les spécifications suivantes:\n\n`;
    prompt += `Type d'intégration: ${integrationType}\n`;
    prompt += `Problème à résoudre: ${problem}\n`;
    prompt += `Événements déclencheurs: ${events}\n`;
    prompt += `Actions à effectuer: ${actions}\n`;
    prompt += `Utilisateurs cibles: ${users}\n\n`;

    // Add specific instructions based on integration type for better generation
    if (integrationType === 'GitHub App') {
      prompt += `Le code doit être une structure de base pour une GitHub App en Node.js (Probot ou Octokit.js) qui écoute les webhooks spécifiés et effectue les actions. Inclure des commentaires pour expliquer chaque partie.\n`;
    } else if (integrationType === 'GitHub Actions Workflow') {
      prompt += `Le code doit être un fichier YAML pour un workflow GitHub Actions (.github/workflows/main.yml) qui se déclenche sur les événements spécifiés et exécute les actions. Inclure des commentaires pour expliquer chaque étape.\n`;
    } else if (integrationType === 'Action personnalisée') {
      prompt += `Le code doit être une action personnalisée pour GitHub Actions. Fournir le fichier action.yml et un script JavaScript (index.js) ou un Dockerfile simple qui effectue les actions. Inclure des commentaires pour expliquer le code.\n`;
    }

    prompt += `Le code doit être complet et prêt à être utilisé comme point de départ.`;

    try {
      // LLM API call
      let chatHistory = [];
      chatHistory.push({ role: "user", parts: [{ text: prompt }] });
      const payload = { contents: chatHistory };
      const apiKey = ""; // API key will be provided by the environment
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const result = await response.json();

      if (result.candidates && result.candidates.length > 0 &&
          result.candidates[0].content && result.candidates[0].content.parts &&
          result.candidates[0].content.parts.length > 0) {
        const text = result.candidates[0].content.parts[0].text;
        setGeneratedCode(text);
        setCurrentStep(4); // Move to display code step
      } else {
        setError("Impossible de générer le code. Veuillez réessayer.");
        console.error("Unexpected API response structure:", result);
      }
    } catch (err) {
      setError(`Erreur lors de la génération du code: ${err.message}. Veuillez vérifier votre connexion ou réessayer.`);
      console.error("Error during code generation:", err);
    } finally {
      setIsLoading(false);
    }
  };

  // Render different steps based on currentStep state
  const renderStep = () => {
    switch (currentStep) {
      case 0:
        return (
          <div className="text-center">
            <h2 className="text-2xl font-bold mb-4">Bienvenue au Générateur de Code pour Intégrations GitHub !</h2>
            <p className="mb-6 text-lg">
              Cet outil vous aidera à concevoir et à générer le code de base pour vos intégrations GitHub, en suivant le plan que nous avons établi.
            </p>
            <button
              onClick={nextStep}
              className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105"
            >
              Commencer
            </button>
          </div>
        );
      case 1:
        return (
          <div className="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md">
            <h2 className="text-2xl font-bold mb-6 text-center">Étape 1: Définir le besoin et le cas d'utilisation</h2>
            <div className="mb-4">
              <label htmlFor="problem" className="block text-gray-700 text-sm font-bold mb-2">
                Quel problème l'intégration va-t-elle résoudre ?
              </label>
              <textarea
                id="problem"
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline h-24 resize-y"
                value={problem}
                onChange={(e) => setProblem(e.target.value)}
                placeholder="Ex: Automatiser la labellisation des issues, synchroniser des projets avec un outil externe..."
              ></textarea>
            </div>
            <div className="mb-4">
              <label htmlFor="events" className="block text-gray-700 text-sm font-bold mb-2">
                Quels événements GitHub déclencheront l'intégration ?
              </label>
              <input
                type="text"
                id="events"
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                value={events}
                onChange={(e) => setEvents(e.target.value)}
                placeholder="Ex: issues.opened, pull_request.closed, push"
              />
            </div>
            <div className="mb-4">
              <label htmlFor="actions" className="block text-gray-700 text-sm font-bold mb-2">
                Quelles actions l'intégration doit-elle effectuer sur GitHub ou en dehors ?
              </label>
              <textarea
                id="actions"
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline h-24 resize-y"
                value={actions}
                onChange={(e) => setActions(e.target.value)}
                placeholder="Ex: Créer un commentaire, fermer une pull request, appeler une API externe..."
              ></textarea>
            </div>
            <div className="mb-6">
              <label htmlFor="users" className="block text-gray-700 text-sm font-bold mb-2">
                Qui utilisera cette intégration ?
              </label>
              <input
                type="text"
                id="users"
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                value={users}
                onChange={(e) => setUsers(e.target.value)}
                placeholder="Ex: Utilisateurs individuels, équipes, organisations entières"
              />
            </div>
            <div className="flex justify-between">
              <button
                onClick={prevStep}
                className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300 ease-in-out"
              >
                Précédent
              </button>
              <button
                onClick={nextStep}
                disabled={!problem || !events || !actions || !users}
                className={`bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300 ease-in-out ${
                  (!problem || !events || !actions || !users) ? 'opacity-50 cursor-not-allowed' : 'transform hover:scale-105'
                }`}
              >
                Suivant
              </button>
            </div>
          </div>
        );
      case 2:
        return (
          <div className="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md">
            <h2 className="text-2xl font-bold mb-6 text-center">Étape 2: Choisir le bon type d'intégration</h2>
            <p className="mb-4 text-gray-700">Sélectionnez le type d'intégration qui convient le mieux à votre besoin :</p>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
              <button
                onClick={() => setIntegrationType('GitHub App')}
                className={`p-4 rounded-lg border-2 ${
                  integrationType === 'GitHub App' ? 'border-blue-600 bg-blue-50' : 'border-gray-300 hover:border-blue-400'
                } transition duration-300 ease-in-out text-left`}
              >
                <h3 className="font-bold text-lg mb-2">GitHub App</h3>
                <p className="text-sm text-gray-600">Pour des applications durables, authentification fine, interaction complexe avec l'API, ou fonctionnement sur plusieurs dépôts/organisations.</p>
              </button>
              <button
                onClick={() => setIntegrationType('GitHub Actions Workflow')}
                className={`p-4 rounded-lg border-2 ${
                  integrationType === 'GitHub Actions Workflow' ? 'border-blue-600 bg-blue-50' : 'border-gray-300 hover:border-blue-400'
                } transition duration-300 ease-in-out text-left`}
              >
                <h3 className="font-bold text-lg mb-2">GitHub Actions Workflow</h3>
                <p className="text-sm text-gray-600">Pour l'automatisation spécifique à un dépôt, déclenchée par des événements standard de GitHub.</p>
              </button>
              <button
                onClick={() => setIntegrationType('Action personnalisée')}
                className={`p-4 rounded-lg border-2 ${
                  integrationType === 'Action personnalisée' ? 'border-blue-600 bg-blue-50' : 'border-gray-300 hover:border-blue-400'
                } transition duration-300 ease-in-out text-left`}
              >
                <h3 className="font-bold text-lg mb-2">Action personnalisée</h3>
                <p className="text-sm text-gray-600">Pour une logique réutilisable à partager avec d'autres workflows ou utilisateurs.</p>
              </button>
            </div>
            <div className="flex justify-between">
              <button
                onClick={prevStep}
                className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300 ease-in-out"
              >
                Précédent
              </button>
              <button
                onClick={nextStep}
                disabled={!integrationType}
                className={`bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300 ease-in-out ${
                  !integrationType ? 'opacity-50 cursor-not-allowed' : 'transform hover:scale-105'
                }`}
              >
                Suivant
              </button>
            </div>
          </div>
        );
      case 3:
        return (
          <div className="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md text-center">
            <h2 className="text-2xl font-bold mb-6">Prêt à générer le code ?</h2>
            <p className="mb-4 text-gray-700">
              Basé sur vos sélections, je vais maintenant générer le code de base pour votre intégration GitHub.
            </p>
            <p className="mb-6 text-gray-700 font-semibold">
              Type sélectionné: <span className="text-blue-600">{integrationType}</span>
            </p>
            {error && <p className="text-red-500 mb-4">{error}</p>}
            <div className="flex justify-between">
              <button
                onClick={prevStep}
                className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300 ease-in-out"
              >
                Précédent
              </button>
              <button
                onClick={generateCode}
                disabled={isLoading}
                className={`bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out ${
                  isLoading ? 'opacity-50 cursor-not-allowed' : 'transform hover:scale-105'
                }`}
              >
                {isLoading ? (
                  <div className="flex items-center justify-center">
                    <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Génération...
                  </div>
                ) : (
                  'Générer le code'
                )}
              </button>
            </div>
          </div>
        );
      case 4:
        return (
          <div className="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-md">
            <h2 className="text-2xl font-bold mb-6 text-center">Code généré pour votre intégration GitHub</h2>
            {error && <p className="text-red-500 mb-4">{error}</p>}
            <div className="bg-gray-800 text-white p-4 rounded-lg overflow-x-auto mb-6">
              <pre><code>{generatedCode || 'Aucun code généré.'}</code></pre>
            </div>
            <div className="flex justify-between">
              <button
                onClick={() => setCurrentStep(0)} // Restart from the beginning
                className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300 ease-in-out"
              >
                Recommencer
              </button>
              <button
                onClick={() => {
                  // Copy to clipboard functionality
                  const el = document.createElement('textarea');
                  el.value = generatedCode;
                  document.body.appendChild(el);
                  el.select();
                  document.execCommand('copy');
                  document.body.removeChild(el);
                  alert('Code copié dans le presse-papiers !'); // Using alert for simplicity, could be a custom modal
                }}
                className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300 ease-in-out transform hover:scale-105"
              >
                Copier le code
              </button>
            </div>
          </div>
        );
      default:
        return null;
    }
  };

  return (
    <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4 font-sans">
      <div className="w-full">
        {renderStep()}
      </div>
    </div>
  );
}

export default App;<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F.L.Q.réseau</title>
    <!-- Chosen Palette: Calm Harmony (Warm Neutrals: #f4f5f7, #ffffff, #f8fafc; Muted Blue Accent: #3b82f6, #2563eb, #dbeafe; Text: #1e293b, #334155, #475569) -->
    <!-- Application Structure Plan: Une disposition à deux colonnes. La colonne de gauche sert de barre latérale de navigation, permettant aux utilisateurs de basculer entre les sections principales comme 'Fil d'Actualité', 'Profil', 'Amis', 'Messages' et 'Notifications'. La colonne de droite est la zone de contenu principale, se mettant à jour dynamiquement pour afficher le contenu de la section sélectionnée. Cette structure reflète les tableaux de bord de médias sociaux courants, offrant une navigation intuitive et une séparation claire des préoccupations, facilitant la compréhension des différentes facettes des médias sociaux par l'utilisateur. Une page de connexion/inscription simulée est ajoutée comme point d'entrée initial. -->
    <!-- Visualization & Content Choices:
    - Report Info: Fil d'actualité de l'utilisateur (publications). Objectif: Informer/Engager. Visualisation: Liste dynamique de cartes HTML pour les publications. Interaction: Bouton 'J'aime', champ de saisie simulé pour les 'Commentaires', et un champ de saisie pour 'Créer une publication'. Justification: Imite l'interaction principale des médias sociaux et permet la génération de contenu par l'utilisateur. Bibliothèque: JavaScript Vanilla.
    - Report Info: Profils d'utilisateur. Objectif: Informer/Modifier. Visualisation: Contenu HTML statique avec les détails de l'utilisateur et une liste de ses publications, avec un formulaire de modification. Interaction: Clic de navigation pour voir le profil de l'utilisateur, bouton 'Modifier' pour changer les infos. Justification: Fournit des informations contextuelles sur les utilisateurs et simule la navigation vers les profils et la mise à jour des données. Bibliothèque: JavaScript Vanilla.
    - Report Info: Liste d'amis. Objectif: Informer/Organiser. Visualisation: Liste défilante de noms d'amis. Interaction: Clic pour afficher le profil de l'ami (simulé). Justification: Fonctionnalité standard des réseaux sociaux avec une interaction améliorée. Bibliothèque: JavaScript Vanilla.
    - Report Info: Notifications. Objectif: Informer/Gérer. Visualisation: Liste simple d'alertes textuelles avec des boutons d'action. Interaction: Effacer tout, accepter/refuser les demandes d'amis. Justification: Mécanisme d'alerte de base avec gestion des requêtes. Bibliothèque: JavaScript Vanilla.
    - Report Info: Données d'engagement des publications. Objectif: Comparer/Informer. Visualisation: Diagramme à barres (Chart.js) montrant les likes/commentaires par type de publication. Interaction: Affichage statique. Justification: Fournit un aperçu quantitatif simple de la performance du contenu. Bibliothèque: Chart.js.
    - Report Info: Messagerie. Objectif: Informer/Engager/Démarrer. Visualisation: Liste des fils de discussion, avec un champ de saisie de texte simple pour les nouveaux messages et une section pour démarrer de nouvelles conversations. Interaction: Clic sur le fil, saisie de message, sélection d'un ami pour démarrer un nouveau chat. Justification: Simule une communication de base et la création de nouvelles interactions. Bibliothèque: JavaScript Vanilla.
    - Report Info: Inscription/Connexion. Objectif: Simuler l'accès au réseau. Visualisation: Formulaire simple avec liste d'utilisateurs existants. Interaction: Sélectionner un utilisateur, créer un nouvel utilisateur. Justification: Point d'entrée pour l'application. Bibliothèque: JavaScript Vanilla.
    - CONFIRMATION: AUCUN graphique SVG utilisé. AUCUN Plotly.js utilisé. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        html { font-family: 'Inter', sans-serif; }
        body { background-color: #f4f5f7; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding: 1.5rem; border: 1px solid #bfdbfe; }
        .nav-item { padding: 0.75rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
        .nav-item:hover { background-color: #f0f4f8; }
        .nav-item.active { background-color: #dbeafe; color: #2563eb; font-weight: 600; border-left: 4px solid #3b82f6; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 0.75rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 500px;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8 bg-blue-50 p-6 rounded-lg">
            <h1 class="text-4xl font-bold text-blue-800 flex items-center justify-center gap-3">
                <span class="bg-blue-600 text-white text-3xl p-2 rounded-full leading-none">⚜️</span>
                F.L.Q.réseau
            </h1>
            <p class="text-lg text-blue-600 mt-2">Explorez et interagissez avec les concepts fondamentaux d'une plateforme de médias sociaux.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-4 gap-8">

            <!-- Panneau latéral gauche : Navigation -->
            <aside id="sidebar-nav" class="lg:col-span-1 flex flex-col gap-4 hidden">
                <section class="card">
                    <h2 class="text-2xl font-bold mb-4">Navigation</h2>
                    <nav>
                        <ul>
                            <li><div id="nav-feed" class="nav-item active">Fil d'Actualité</div></li>
                            <li><div id="nav-profile" class="nav-item">Mon Profil</div></li>
                            <li><div id="nav-friends" class="nav-item">Amis</div></li>
                            <li><div id="nav-messages" class="nav-item">Messages <span id="message-badge" class="ml-2 px-2 py-0.5 bg-blue-500 text-white text-xs font-bold rounded-full hidden"></span></div></li>
                            <li><div id="nav-notifications" class="nav-item">Notifications <span id="notification-badge" class="ml-2 px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded-full hidden"></span></div></li>
                            <li><div id="nav-analytics" class="nav-item">Statistiques</div></li>
                        </ul>
                    </nav>
                </section>
            </aside>

            <!-- Zone de contenu principale droite -->
            <div id="main-content-wrapper" class="lg:col-span-3 flex flex-col gap-8">
                <section id="main-content" class="card flex-grow min-h-[600px]">
                    <!-- Le contenu sera chargé dynamiquement ici -->
                </section>
            </div>
        </main>
    </div>

    <!-- Modal de connexion/inscription -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-center">Bienvenue sur F.L.Q.réseau</h2>
            <p class="text-slate-600 mb-6 text-center">Veuillez vous connecter ou vous inscrire pour continuer.</p>

            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-3">Se connecter en tant que :</h3>
                <div id="user-list" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <!-- Les utilisateurs existants seront chargés ici -->
                </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold mb-3">S'inscrire (Nouvel Utilisateur) :</h3>
                <input type="text" id="register-name" class="w-full p-2 border border-slate-300 rounded-md mb-2" placeholder="Votre nom">
                <input type="text" id="register-avatar" class="w-full p-2 border border-slate-300 rounded-md mb-2" placeholder="Votre avatar (ex: 😊)">
                <textarea id="register-bio" class="w-full p-2 border border-slate-300 rounded-md mb-3 resize-y" placeholder="Votre biographie..."></textarea>
                <button id="register-button" class="w-full px-6 py-2 bg-green-500 text-white font-semibold rounded-md hover:bg-green-600 transition-colors">S'inscrire</button>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    const mainContent = document.getElementById('main-content');
    const navItems = document.querySelectorAll('.nav-item');
    const messageBadge = document.getElementById('message-badge');
    const notificationBadge = document.getElementById('notification-badge');
    const sidebarNav = document.getElementById('sidebar-nav');
    const mainContentWrapper = document.getElementById('main-content-wrapper');

    const authModal = document.getElementById('auth-modal');
    const userListDiv = document.getElementById('user-list');
    const registerNameInput = document.getElementById('register-name');
    const registerAvatarInput = document.getElementById('register-avatar');
    const registerBioInput = document.getElementById('register-bio');
    const registerButton = document.getElementById('register-button');

    let currentUserId = null;
    let currentUser = null;

    let users = {
        'user1': { id: 'user1', name: 'Alice Dubois', avatar: '😊', bio: 'Passionnée de technologie et de design.' },
        'user2': { id: 'user2', name: 'Bob Martin', avatar: '😎', bio: 'Développeur web et amateur de café.' },
        'user3': { id: 'user3', name: 'Charlie Dupont', avatar: '🤓', bio: 'Chercheur en IA et joueur d\'échecs.' },
        'user4': { id: 'user4', name: 'Diana Leroy', avatar: '😇', bio: 'Artiste numérique et amoureuse des animaux.' }
    };

    let posts = [
        { id: 'p1', userId: 'user1', type: 'text', content: "J'adore créer des interfaces utilisateur intuitives ! C'est tellement gratifiant.", likes: 15, comments: [{userId: 'user2', text: 'Super !'}, {userId: 'user3', text: 'Totalement d\'accord !'}], timestamp: new Date('2024-07-08T10:00:00') },
        { id: 'p2', userId: 'user2', type: 'image', content: "Nouvelle photo de mon chat ! 😻", likes: 22, comments: [{userId: 'user1', text: 'Trop mignon !'}, {userId: 'user4', text: 'Adorable !'}], timestamp: new Date('2024-07-07T14:30:00') },
        { id: 'p3', userId: 'user3', type: 'link', content: "Article intéressant sur l'IA éthique : [Lien simulé]", likes: 8, comments: [{userId: 'user1', text: 'À lire absolument !'}], timestamp: new Date('2024-07-06T09:15:00') },
        { id: 'p4', userId: 'user1', type: 'text', content: "Je travaille sur un nouveau projet passionnant. Plus de détails bientôt !", likes: 10, comments: [], timestamp: new Date('2024-07-05T18:00:00') },
        { id: 'p5', userId: 'user4', type: 'text', content: "Bonne journée à tous !", likes: 5, comments: [], timestamp: new Date('2024-07-04T08:00:00') }
    ];

    let notifications = [
        { id: 'n1', type: 'like', targetUserId: 'user1', sourceUserId: 'user2', postId: 'p1', message: 'Bob Martin a aimé votre publication.', read: false, timestamp: new Date('2024-07-08T10:30:00') },
        { id: 'n2', type: 'comment', targetUserId: 'user1', sourceUserId: 'user3', postId: 'p1', message: 'Charlie Dupont a commenté votre publication.', read: false, timestamp: new Date('2024-07-08T10:45:00') },
        { id: 'n3', type: 'friend_request', targetUserId: 'user1', sourceUserId: 'user4', message: 'Diana Leroy vous a envoyé une demande d\'ami.', read: false, timestamp: new Date('2024-07-07T12:00:00') },
        { id: 'n4', type: 'friend_request', targetUserId: 'user2', sourceUserId: 'user3', message: 'Charlie Dupont vous a envoyé une demande d\'ami.', read: true, timestamp: new Date('2024-07-06T10:00:00') }
    ];

    let messages = {
        'user1': {
            'user2': [
                { sender: 'user2', content: 'Salut Alice, comment ça va ?', timestamp: new Date('2024-07-08T11:00:00'), read: true },
                { sender: 'user1', content: 'Salut Bob ! Très bien, et toi ?', timestamp: new Date('2024-07-08T11:05:00'), read: true }
            ],
            'user3': [
                { sender: 'user3', content: 'As-tu vu le dernier article sur l\'IA ?', timestamp: new Date('2024-07-07T16:00:00'), read: false }
            ]
        },
        'user2': {
            'user1': [
                { sender: 'user1', content: 'Salut Bob ! Très bien, et toi ?', timestamp: new Date('2024-07-08T11:05:00'), read: true },
                { sender: 'user2', content: 'Salut Alice, comment ça va ?', timestamp: new Date('2024-07-08T11:00:00'), read: true }
            ]
        }
    };

    users['user1'].friends = ['user2', 'user3', 'user4'];
    users['user2'].friends = ['user1', 'user3'];
    users['user3'].friends = ['user1', 'user2'];
    users['user4'].friends = ['user1'];

    function generateUniqueId(prefix = 'id') {
        return prefix + Date.now() + Math.floor(Math.random() * 1000);
    }

    function updateBadges() {
        let unreadMessagesCount = 0;
        if (currentUser && messages[currentUser.id]) {
            Object.values(messages[currentUser.id]).forEach(thread => {
                unreadMessagesCount += thread.filter(msg => msg.sender !== currentUser.id && !msg.read).length;
            });
        }
        let unreadNotificationsCount = notifications.filter(n => n.targetUserId === currentUser.id && !n.read).length;

        if (unreadMessagesCount > 0) {
            messageBadge.textContent = unreadMessagesCount;
            messageBadge.classList.remove('hidden');
        } else {
            messageBadge.classList.add('hidden');
        }

        if (unreadNotificationsCount > 0) {
            notificationBadge.textContent = unreadNotificationsCount;
            notificationBadge.classList.remove('hidden');
        } else {
            notificationBadge.classList.add('hidden');
        }
    }

    function renderFeed() {
        mainContent.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">Fil d'Actualité</h2>
            <p class="text-slate-600 mb-6">Explorez les dernières publications de vos amis. Interagissez en aimant ou en commentant, ou créez votre propre publication !</p>
            
            <div class="card mb-6">
                <h3 class="text-xl font-bold mb-3">Créer une Publication</h3>
                <textarea id="new-post-content" class="w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition resize-y min-h-[80px]" placeholder="Quoi de neuf, ${currentUser.name} ?"></textarea>
                <button id="create-post-button" class="mt-3 px-6 py-2 bg-blue-500 text-white font-semibold rounded-md hover:bg-blue-600 transition-colors">Publier</button>
            </div>

            <div id="posts-container" class="space-y-6"></div>
        `;
        const postsContainer = document.getElementById('posts-container');
        const newPostContentInput = document.getElementById('new-post-content');
        const createPostButton = document.getElementById('create-post-button');

        createPostButton.addEventListener('click', () => {
            const content = newPostContentInput.value.trim();
            if (content) {
                const newPost = {
                    id: generateUniqueId('p'),
                    userId: currentUser.id,
                    type: 'text',
                    content: content,
                    likes: 0,
                    comments: [],
                    timestamp: new Date()
                };
                posts.unshift(newPost);
                Object.values(users).forEach(user => {
                    if (user.id !== currentUser.id && user.friends.includes(currentUser.id)) {
                        notifications.unshift({
                            id: generateUniqueId('n'),
                            type: 'new_post',
                            targetUserId: user.id,
                            sourceUserId: currentUser.id,
                            postId: newPost.id,
                            message: `${currentUser.name} a créé une nouvelle publication.`,
                            read: false,
                            timestamp: new Date()
                        });
                    }
                });
                newPostContentInput.value = '';
                renderFeed();
                updateBadges();
            }
        });

        posts.sort((a, b) => b.timestamp - a.timestamp).forEach(post => {
            const postUser = users[post.userId];
            const postElement = document.createElement('div');
            postElement.className = 'bg-slate-50 p-4 rounded-lg shadow-sm border border-slate-200';
            postElement.innerHTML = `
                <div class="flex items-center mb-3">
                    <span class="text-2xl mr-2">${postUser.avatar}</span>
                    <button class="font-semibold text-slate-900 hover:underline" data-user-id="${post.userId}">${postUser.name}</button>
                    <span class="text-xs text-slate-500 ml-auto">${timeAgo(post.timestamp)}</span>
                </div>
                <p class="text-slate-700 mb-4">${post.content}</p>
                <div class="flex items-center text-slate-600 text-sm">
                    <button class="like-button flex items-center mr-4 hover:text-blue-600 transition-colors" data-post-id="${post.id}">
                        <span class="mr-1">👍</span> <span class="like-count">${post.likes}</span>
                    </button>
                    <span class="flex items-center"><span class="mr-1">💬</span> ${post.comments.length}</span>
                </div>
                <div class="mt-3 border-t border-slate-200 pt-3">
                    <div class="comments-list space-y-2 mb-3">
                        ${post.comments.map(comment => {
                            const commenter = users[comment.userId] || { name: 'Utilisateur Inconnu', avatar: '❓' };
                            return `<div class="text-sm text-slate-600 bg-slate-100 p-2 rounded-md"><strong>${commenter.name}:</strong> ${comment.text}</div>`;
                        }).join('')}
                    </div>
                    <input type="text" class="comment-input w-full p-2 text-sm border border-slate-300 rounded-md focus:ring-1 focus:ring-blue-500" placeholder="Ajouter un commentaire..." data-post-id="${post.id}">
                </div>
            `;
            postsContainer.appendChild(postElement);
        });

        postsContainer.querySelectorAll('.like-button').forEach(button => {
            button.addEventListener('click', (e) => {
                const postId = e.currentTarget.dataset.postId;
                const post = posts.find(p => p.id === postId);
                if (post) {
                    post.likes++;
                    e.currentTarget.querySelector('.like-count').textContent = post.likes;
                    if (post.userId !== currentUser.id) {
                        notifications.unshift({
                            id: generateUniqueId('n'),
                            type: 'like',
                            targetUserId: post.userId,
                            sourceUserId: currentUser.id,
                            postId: post.id,
                            message: `${currentUser.name} a aimé votre publication.`,
                            read: false,
                            timestamp: new Date()
                        });
                        updateBadges();
                    }
                }
            });
        });

        postsContainer.querySelectorAll('.comment-input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && input.value.trim()) {
                    const postId = e.target.dataset.postId;
                    const post = posts.find(p => p.id === postId);
                    if (post) {
                        post.comments.push({ userId: currentUser.id, text: input.value.trim() });
                        if (post.userId !== currentUser.id) {
                            notifications.unshift({
                                id: generateUniqueId('n'),
                                type: 'comment',
                                targetUserId: post.userId,
                                sourceUserId: currentUser.id,
                                postId: post.id,
                                message: `${currentUser.name} a commenté votre publication.`,
                                read: false,
                                timestamp: new Date()
                            });
                            updateBadges();
                        }
                        renderFeed();
                    }
                }
            });
        });

        postsContainer.querySelectorAll('button[data-user-id]').forEach(button => {
            button.addEventListener('click', (e) => {
                const userId = e.currentTarget.dataset.userId;
                if (userId === currentUser.id) {
                    setActiveNav('nav-profile');
                } else {
                    renderUserProfile(userId);
                }
            });
        });
    }

    function renderProfile() {
        mainContent.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">Mon Profil</h2>
            <p class="text-slate-600 mb-6">Consultez vos informations personnelles et vos publications.</p>
            <div class="bg-slate-50 p-6 rounded-lg shadow-sm border border-slate-200 text-center mb-6">
                <span class="text-6xl">${currentUser.avatar}</span>
                <h3 class="text-3xl font-bold text-slate-900 mt-3">${currentUser.name}</h3>
                <p id="profile-bio" class="text-slate-600 mt-2">${currentUser.bio}</p>
                <button id="edit-profile-button" class="mt-4 px-6 py-2 bg-blue-500 text-white font-semibold rounded-md hover:bg-blue-600 transition-colors">Modifier le profil</button>
            </div>
            <h3 class="text-xl font-bold mb-4">Mes Publications</h3>
            <div id="my-posts-container" class="space-y-4"></div>
        `;
        const myPostsContainer = document.getElementById('my-posts-container');
        const editProfileButton = document.getElementById('edit-profile-button');

        editProfileButton.addEventListener('click', renderEditProfile);

        posts.filter(p => p.userId === currentUser.id).sort((a, b) => b.timestamp - a.timestamp).forEach(post => {
            const postElement = document.createElement('div');
            postElement.className = 'bg-white p-3 rounded-md shadow-sm border border-slate-200';
            postElement.innerHTML = `
                <p class="text-slate-700">${post.content}</p>
                <div class="flex items-center text-slate-600 text-sm mt-2">
                    <button class="like-button flex items-center mr-4 hover:text-blue-600 transition-colors" data-post-id="${post.id}">
                        <span class="mr-1">👍</span> <span class="like-count">${post.likes}</span>
                    </button>
                    <span>💬 ${post.comments.length}</span>
                    <span class="ml-auto text-xs text-slate-500">${timeAgo(post.timestamp)}</span>
                </div>
                <div class="mt-3 border-t border-slate-200 pt-3">
                    <div class="comments-list space-y-2 mb-3">
                        ${post.comments.map(comment => {
                            const commenter = users[comment.userId] || { name: 'Utilisateur Inconnu', avatar: '❓' };
                            return `<div class="text-sm text-slate-600 bg-slate-100 p-2 rounded-md"><strong>${commenter.name}:</strong> ${comment.text}</div>`;
                        }).join('')}
                    </div>
                    <input type="text" class="comment-input w-full p-2 text-sm border border-slate-300 rounded-md focus:ring-1 focus:ring-blue-500" placeholder="Ajouter un commentaire..." data-post-id="${post.id}">
                </div>
            `;
            myPostsContainer.appendChild(postElement);
        });

        myPostsContainer.querySelectorAll('.like-button').forEach(button => {
            button.addEventListener('click', (e) => {
                const postId = e.currentTarget.dataset.postId;
                const post = posts.find(p => p.id === postId);
                if (post) {
                    post.likes++;
                    e.currentTarget.querySelector('.like-count').textContent = post.likes;
                    if (post.userId !== currentUser.id) {
                        notifications.unshift({
                            id: generateUniqueId('n'),
                            type: 'like',
                            targetUserId: post.userId,
                            sourceUserId: currentUser.id,
                            postId: post.id,
                            message: `${currentUser.name} a aimé votre publication.`,
                            read: false,
                            timestamp: new Date()
                        });
                        updateBadges();
                    }
                }
            });
        });

        myPostsContainer.querySelectorAll('.comment-input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && input.value.trim()) {
                    const postId = e.target.dataset.postId;
                    const post = posts.find(p => p.id === postId);
                    if (post) {
                        post.comments.push({ userId: currentUser.id, text: input.value.trim() });
                        if (post.userId !== currentUser.id) {
                            notifications.unshift({
                                id: generateUniqueId('n'),
                                type: 'comment',
                                targetUserId: post.userId,
                                sourceUserId: currentUser.id,
                                postId: post.id,
                                message: `${currentUser.name} a commenté votre publication.`,
                                read: false,
                                timestamp: new Date()
                            });
                            updateBadges();
                        }
                        renderProfile();
                    }
                }
            });
        });
    }

    function renderEditProfile() {
        mainContent.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">Modifier le Profil</h2>
            <p class="text-slate-600 mb-6">Mettez à jour vos informations personnelles.</p>
            <div class="card">
                <div class="mb-4">
                    <label for="edit-name" class="block text-sm font-medium text-slate-700 mb-1">Nom :</label>
                    <input type="text" id="edit-name" class="w-full p-2 border border-slate-300 rounded-md" value="${currentUser.name}">
                </div>
                <div class="mb-4">
                    <label for="edit-avatar" class="block text-sm font-medium text-slate-700 mb-1">Avatar (Emoji) :</label>
                    <input type="text" id="edit-avatar" class="w-full p-2 border border-slate-300 rounded-md" value="${currentUser.avatar}">
                </div>
                <div class="mb-4">
                    <label for="edit-bio" class="block text-sm font-medium text-slate-700 mb-1">Biographie :</label>
                    <textarea id="edit-bio" class="w-full p-2 border border-slate-300 rounded-md resize-y min-h-[100px]">${currentUser.bio}</textarea>
                </div>
                <div class="flex gap-4">
                    <button id="save-profile-button" class="px-6 py-2 bg-blue-500 text-white font-semibold rounded-md hover:bg-blue-600 transition-colors">Enregistrer</button>
                    <button id="cancel-edit-button" class="px-6 py-2 bg-slate-300 text-slate-800 font-semibold rounded-md hover:bg-slate-400 transition-colors">Annuler</button>
                </div>
            </div>
        `;

        document.getElementById('save-profile-button').addEventListener('click', () => {
            currentUser.name = document.getElementById('edit-name').value.trim();
            currentUser.avatar = document.getElementById('edit-avatar').value.trim() || '❓';
            currentUser.bio = document.getElementById('edit-bio').value.trim();
            users[currentUser.id] = { ...currentUser };
            renderProfile();
        });

        document.getElementById('cancel-edit-button').addEventListener('click', renderProfile);
    }

    function renderUserProfile(userId) {
        const user = users[userId];
        if (!user) {
            mainContent.innerHTML = `<h2 class="text-2xl font-bold mb-4">Profil Introuvable</h2><p>Cet utilisateur n'existe pas.</p>`;
            return;
        }

        const isFriend = currentUser.friends.includes(userId);
        const friendButtonText = isFriend ? 'Ami(e)' : 'Ajouter en ami';
        const friendButtonClass = isFriend ? 'bg-slate-400 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600';

        mainContent.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">Profil de ${user.name}</h2>
            <p class="text-slate-600 mb-6">Consultez les informations et les publications de cet utilisateur.</p>
            <div class="bg-slate-50 p-6 rounded-lg shadow-sm border border-slate-200 text-center mb-6">
                <span class="text-6xl">${user.avatar}</span>
                <h3 class="text-3xl font-bold text-slate-900 mt-3">${user.name}</h3>
                <p class="text-slate-600 mt-2">${user.bio || 'Aucune biographie disponible.'}</p>
                ${userId !== currentUser.id ? `<button id="add-friend-button" class="mt-4 px-6 py-2 text-white font-semibold rounded-md ${friendButtonClass}" data-user-id="${userId}" ${isFriend ? 'disabled' : ''}>${friendButtonText}</button>` : ''}
            </div>
            <h3 class="text-xl font-bold mb-4">Publications de ${user.name}</h3>
            <div id="user-posts-container" class="space-y-4"></div>
        `;

        const userPostsContainer = document.getElementById('user-posts-container');
        posts.filter(p => p.userId === userId).sort((a, b) => b.timestamp - a.timestamp).forEach(post => {
            const postElement = document.createElement('div');
            postElement.className = 'bg-white p-3 rounded-md shadow-sm border border-slate-200';
            postElement.innerHTML = `
                <p class="text-slate-700">${post.content}</p>
                <div class="flex items-center text-slate-600 text-sm mt-2">
                    <span class="mr-3">👍 ${post.likes}</span>
                    <span>💬 ${post.comments.length}</span>
                    <span class="ml-auto text-xs text-slate-500">${timeAgo(post.timestamp)}</span>
                </div>
            `;
            userPostsContainer.appendChild(postElement);
        });

        const addFriendButton = document.getElementById('add-friend-button');
        if (addFriendButton && !isFriend) {
            addFriendButton.addEventListener('click', (e) => {
                const targetUserId = e.currentTarget.dataset.userId;
                if (!currentUser.friends.includes(targetUserId)) {
                    notifications.unshift({
                        id: generateUniqueId('n'),
                        type: 'friend_request',
                        targetUserId: targetUserId,
                        sourceUserId: currentUser.id,
                        message: `${currentUser.name} vous a envoyé une demande d'ami.`,
                        read: false,
                        timestamp: new Date()
                    });
                    e.currentTarget.textContent = 'Demande envoyée !';
                    e.currentTarget.disabled = true;
                    e.currentTarget.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                    e.currentTarget.classList.add('bg-green-500', 'cursor-not-allowed');
                    updateBadges();
                }
            });
        }
    }

    function renderFriends() {
        mainContent.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">Mes Amis</h2>
            <p class="text-slate-600 mb-6">Parcourez votre liste d'amis. Cliquez sur un ami pour voir son profil.</p>
            <ul class="space-y-3"></ul>
        `;
        const friendsList = mainContent.querySelector('ul');
        currentUser.friends.forEach(friendId => {
            const friend = users[friendId];
            const li = document.createElement('li');
            li.className = 'bg-slate-50 p-3 rounded-lg shadow-sm flex items-center hover:bg-slate-100 transition-colors cursor-pointer';
            li.innerHTML = `<span class="text-3xl mr-3">${friend.avatar}</span> <span class="font-semibold text-lg">${friend.name}</span>`;
            li.addEventListener('click', () => {
                renderUserProfile(friendId);
            });
            friendsList.appendChild(li);
        });
    }

    function renderMessages() {
        mainContent.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">Messages</h2>
            <p class="text-slate-600 mb-6">Gérez vos conversations. Les messages non lus sont indiqués.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 h-[400px]">
                <div class="md:col-span-1 bg-slate-50 p-4 rounded-lg shadow-sm border border-slate-200 overflow-y-auto">
                    <h3 class="font-bold mb-3">Conversations</h3>
                    <ul id="chat-threads" class="space-y-2 mb-4"></ul>
                    <h3 class="font-bold mb-3">Démarrer une nouvelle conversation</h3>
                    <ul id="new-chat-friends" class="space-y-2"></ul>
                </div>
                <div class="md:col-span-2 bg-slate-50 p-4 rounded-lg shadow-sm border border-slate-200 flex flex-col">
                    <h3 id="current-chat-title" class="font-bold mb-3">Sélectionnez une conversation</h3>
                    <div id="chat-messages" class="flex-grow overflow-y-auto p-2 border border-slate-200 rounded-md bg-white mb-3 space-y-2">
                        <p class="text-slate-500 text-center">Cliquez sur une conversation pour l'ouvrir.</p>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="message-input" class="flex-grow p-2 text-sm border border-slate-300 rounded-md focus:ring-1 focus:ring-blue-500" placeholder="Écrire un message..." disabled>
                        <button id="send-message-button" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50" disabled>Envoyer</button>
                    </div>
                </div>
            </div>
        `;

        const chatThreadsList = document.getElementById('chat-threads');
        const newChatFriendsList = document.getElementById('new-chat-friends');
        const chatMessagesDisplay = document.getElementById('chat-messages');
        const currentChatTitle = document.getElementById('current-chat-title');
        const messageInput = document.getElementById('message-input');
        const sendMessageButton = document.getElementById('send-message-button');
        let activeChatFriendId = null;

        function renderChatThreads() {
            chatThreadsList.innerHTML = '';
            const userChatThreads = messages[currentUser.id] || {};
            const sortedFriendIds = Object.keys(userChatThreads).sort((a, b) => {
                const lastMsgA = userChatThreads[a].length > 0 ? userChatThreads[a][userChatThreads[a].length - 1].timestamp : new Date(0);
                const lastMsgB = userChatThreads[b].length > 0 ? userChatThreads[b][userChatThreads[b].length - 1].timestamp : new Date(0);
                return lastMsgB - lastMsgA;
            });

            sortedFriendIds.forEach(friendId => {
                const friend = users[friendId];
                const threadMessages = userChatThreads[friendId];
                const hasUnread = threadMessages.some(msg => msg.sender !== currentUser.id && !msg.read);

                const li = document.createElement('li');
                li.className = `p-2 rounded-md cursor-pointer hover:bg-slate-100 transition-colors flex items-center ${hasUnread ? 'bg-blue-50 font-semibold' : ''}`;
                li.innerHTML = `<span class="text-xl mr-2">${friend.avatar}</span> ${friend.name} ${hasUnread ? '<span class="ml-auto text-blue-600 text-xs">(Nouveaux)</span>' : ''}`;
                li.addEventListener('click', () => openChat(friendId));
                chatThreadsList.appendChild(li);
            });
        }

        function renderNewChatFriends() {
            newChatFriendsList.innerHTML = '';
            const friendsWithoutChat = currentUser.friends.filter(friendId => !(messages[currentUser.id] && messages[currentUser.id][friendId]));

            if (friendsWithoutChat.length === 0) {
                newChatFriendsList.innerHTML = '<li class="text-slate-500 text-sm p-2">Toutes les conversations sont déjà ouvertes.</li>';
                return;
            }

            friendsWithoutChat.forEach(friendId => {
                const friend = users[friendId];
                const li = document.createElement('li');
                li.className = `p-2 rounded-md cursor-pointer hover:bg-slate-100 transition-colors flex items-center`;
                li.innerHTML = `<span class="text-xl mr-2">${friend.avatar}</span> ${friend.name}`;
                li.addEventListener('click', () => startNewChat(friendId));
                newChatFriendsList.appendChild(li);
            });
        }

        function startNewChat(friendId) {
            if (!messages[currentUser.id]) {
                messages[currentUser.id] = {};
            }
            if (!messages[currentUser.id][friendId]) {
                messages[currentUser.id][friendId] = [];
            }
            if (!messages[friendId]) {
                messages[friendId] = {};
            }
            if (!messages[friendId][currentUser.id]) {
                messages[friendId][currentUser.id] = [];
            }
            openChat(friendId);
            renderNewChatFriends();
        }

        function openChat(friendId) {
            activeChatFriendId = friendId;
            const friend = users[friendId];
            currentChatTitle.textContent = `Conversation avec ${friend.name}`;
            chatMessagesDisplay.innerHTML = '';

            const thread = messages[currentUser.id][friendId] || [];
            thread.forEach(msg => {
                const msgElement = document.createElement('div');
                msgElement.className = `p-2 rounded-lg max-w-[80%] ${msg.sender === currentUser.id ? 'bg-blue-100 ml-auto' : 'bg-slate-100 mr-auto'}`;
                msgElement.textContent = `${users[msg.sender].name}: ${msg.content}`;
                msgElement.title = msg.timestamp.toLocaleString();
                chatMessagesDisplay.appendChild(msgElement);
                if (msg.sender !== currentUser.id) {
                    msg.read = true;
                }
            });
            chatMessagesDisplay.scrollTop = chatMessagesDisplay.scrollHeight;
            messageInput.disabled = false;
            sendMessageButton.disabled = false;
            messageInput.focus();
            updateBadges();
            renderChatThreads();
        }

        sendMessageButton.addEventListener('click', () => {
            if (activeChatFriendId && messageInput.value.trim()) {
                const messageContent = messageInput.value.trim();
                const newMsg = {
                    sender: currentUser.id,
                    content: messageContent,
                    timestamp: new Date(),
                    read: true
                };

                messages[currentUser.id][activeChatFriendId].push(newMsg);

                if (!messages[activeChatFriendId]) {
                    messages[activeChatFriendId] = {};
                }
                if (!messages[activeChatFriendId][currentUser.id]) {
                    messages[activeChatFriendId][currentUser.id] = [];
                }
                messages[activeChatFriendId][currentUser.id].push({
                    sender: currentUser.id,
                    content: messageContent,
                    timestamp: new Date(),
                    read: false
                });

                messageInput.value = '';
                openChat(activeChatFriendId);
            }
        });

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessageButton.click();
        });

        renderChatThreads();
        renderNewChatFriends();
        updateBadges();
    }

    function renderNotifications() {
        mainContent.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">Notifications</h2>
            <p class="text-slate-600 mb-6">Recevez des alertes sur les activités importantes. Marquer toutes comme lues pour effacer le badge.</p>
            <button id="mark-all-read-button" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 mb-4 disabled:opacity-50 disabled:cursor-not-allowed">Marquer tout comme lu</button>
            <ul id="notifications-list" class="space-y-3"></ul>
        `;
        const notificationsList = document.getElementById('notifications-list');
        const markAllReadButton = document.getElementById('mark-all-read-button');

        function updateNotificationsList() {
            notificationsList.innerHTML = '';
            const userNotifications = notifications.filter(n => n.targetUserId === currentUser.id).sort((a, b) => b.timestamp - a.timestamp);

            if (userNotifications.length === 0) {
                notificationsList.innerHTML = '<li class="text-slate-500 text-center p-4">Aucune notification pour le moment.</li>';
            }

            userNotifications.forEach(notification => {
                const li = document.createElement('li');
                li.className = `p-3 rounded-lg shadow-sm border border-slate-200 ${notification.read ? 'bg-white' : 'bg-red-50 font-semibold'}`;
                li.innerHTML = `<span class="text-sm text-slate-500 mr-2">${timeAgo(notification.timestamp)}</span> ${notification.message}`;

                if (notification.type === 'friend_request' && !notification.read) {
                    const acceptBtn = document.createElement('button');
                    acceptBtn.textContent = 'Accepter';
                    acceptBtn.className = 'ml-4 px-3 py-1 bg-green-500 text-white text-sm rounded-md hover:bg-green-600';
                    acceptBtn.addEventListener('click', () => acceptFriendRequest(notification.id, notification.sourceUserId));

                    const declineBtn = document.createElement('button');
                    declineBtn.textContent = 'Refuser';
                    declineBtn.className = 'ml-2 px-3 py-1 bg-red-500 text-white text-sm rounded-md hover:bg-red-600';
                    declineBtn.addEventListener('click', () => declineFriendRequest(notification.id, notification.sourceUserId));

                    li.appendChild(acceptBtn);
                    li.appendChild(declineBtn);
                }
                notificationsList.appendChild(li);
            });
            markAllReadButton.disabled = userNotifications.every(n => n.read);
        }

        markAllReadButton.addEventListener('click', () => {
            notifications.filter(n => n.targetUserId === currentUser.id).forEach(n => n.read = true);
            updateNotificationsList();
            updateBadges();
        });

        updateNotificationsList();
        updateBadges();
    }

    function acceptFriendRequest(notificationId, senderId) {
        if (!currentUser.friends.includes(senderId)) {
            currentUser.friends.push(senderId);
        }
        if (!users[senderId].friends.includes(currentUser.id)) {
            users[senderId].friends.push(currentUser.id);
        }

        const reqNotif = notifications.find(n => n.id === notificationId);
        if (reqNotif) reqNotif.read = true;

        notifications.unshift({
            id: generateUniqueId('n'),
            type: 'friend_request_accepted',
            targetUserId: senderId,
            sourceUserId: currentUser.id,
            message: `${currentUser.name} a accepté votre demande d'ami !`,
            read: false,
            timestamp: new Date()
        });
        renderNotifications();
        updateBadges();
    }

    function declineFriendRequest(notificationId, senderId) {
        const reqNotif = notifications.find(n => n.id === notificationId);
        if (reqNotif) reqNotif.read = true;

        notifications.unshift({
            id: generateUniqueId('n'),
            type: 'friend_request_declined',
            targetUserId: senderId,
            sourceUserId: currentUser.id,
            message: `${currentUser.name} a refusé votre demande d'ami.`,
            read: false,
            timestamp: new Date()
        });
        renderNotifications();
        updateBadges();
    }


    let analyticsChart = null;
    function renderAnalytics() {
        mainContent.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">Statistiques des Publications</h2>
            <p class="text-slate-600 mb-6">Visualisation de l'engagement des publications (likes et commentaires).</p>
            <div class="chart-container">
                <canvas id="postEngagementChart"></canvas>
            </div>
        `;
        const ctx = document.getElementById('postEngagementChart').getContext('2d');

        const postTypes = [...new Set(posts.map(p => p.type))];
        const labels = postTypes.map(type => {
            if (type === 'text') return 'Texte';
            if (type === 'image') return 'Image';
            if (type === 'link') return 'Lien';
            return type;
        });

        const likesData = postTypes.map(type =>
            posts.filter(p => p.type === type).reduce((sum, p) => sum + p.likes, 0)
        );
        const commentsData = postTypes.map(type =>
            posts.filter(p => p.type === type).reduce((sum, p) => sum + p.comments.length, 0)
        );

        if (analyticsChart) {
            analyticsChart.destroy();
        }

        analyticsChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Likes',
                        data: likesData,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Commentaires',
                        data: commentsData,
                        backgroundColor: 'rgba(100, 116, 139, 0.6)',
                        borderColor: 'rgba(100, 116, 139, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Nombre'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Type de Publication'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                         callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y;
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    function timeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        let interval = seconds / 31536000;
        if (interval > 1) return Math.floor(interval) + " ans";
        interval = seconds / 2592000;
        if (interval > 1) return Math.floor(interval) + " mois";
        interval = seconds / 86400;
        if (interval > 1) return Math.floor(interval) + " jours";
        interval = seconds / 3600;
        if (interval > 1) return Math.floor(interval) + " heures";
        interval = seconds / 60;
        if (interval > 1) return Math.floor(interval) + " minutes";
        return Math.floor(seconds) + " secondes";
    }

    const renderers = {
        'nav-feed': renderFeed,
        'nav-profile': renderProfile,
        'nav-friends': renderFriends,
        'nav-messages': renderMessages,
        'nav-notifications': renderNotifications,
        'nav-analytics': renderAnalytics
    };

    function setActiveNav(id) {
        navItems.forEach(item => item.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        renderers[id]();
    }

    navItems.forEach(item => {
        item.addEventListener('click', () => setActiveNav(item.id));
    });

    function showAuthModal() {
        authModal.style.display = 'flex';
        renderUserList();
        sidebarNav.classList.add('hidden');
        mainContentWrapper.classList.add('lg:col-span-4');
        mainContent.innerHTML = '<p class="text-center text-slate-500 p-8">Veuillez vous connecter ou vous inscrire.</p>';
    }

    function hideAuthModal() {
        authModal.style.display = 'none';
        sidebarNav.classList.remove('hidden');
        mainContentWrapper.classList.remove('lg:col-span-4');
    }

    function renderUserList() {
        userListDiv.innerHTML = '';
        Object.values(users).forEach(user => {
            const userCard = document.createElement('button');
            userCard.className = 'flex items-center p-3 bg-slate-100 rounded-md hover:bg-slate-200 transition-colors cursor-pointer';
            userCard.innerHTML = `<span class="text-3xl mr-3">${user.avatar}</span> <span class="font-semibold text-lg">${user.name}</span>`;
            userCard.addEventListener('click', () => loginUser(user.id));
            userListDiv.appendChild(userCard);
        });
    }

    function loginUser(userId) {
        currentUserId = userId;
        currentUser = users[currentUserId];
        hideAuthModal();
        updateBadges();
        setActiveNav('nav-feed');
    }

    registerButton.addEventListener('click', () => {
        const name = registerNameInput.value.trim();
        const avatar = registerAvatarInput.value.trim();
        const bio = registerBioInput.value.trim();

        if (name && avatar) {
            const newUserId = generateUniqueId('user');
            users[newUserId] = {
                id: newUserId,
                name: name,
                avatar: avatar,
                bio: bio || 'Nouvel utilisateur sur F.L.Q.réseau !',
                friends: []
            };
            posts.unshift({
                id: generateUniqueId('p'),
                userId: newUserId,
                type: 'text',
                content: `Bonjour monde ! Je suis ${name} et je viens de rejoindre F.L.Q.réseau !`,
                likes: 0,
                comments: [],
                timestamp: new Date()
            });

            loginUser(newUserId);
            registerNameInput.value = '';
            registerAvatarInput.value = '';
            registerBioInput.value = '';
        } else {
            alert('Veuillez entrer un nom et un avatar pour vous inscrire.');
        }
    });

    showAuthModal();
});
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>NeuraX‑Starfield + WebSocket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html, body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; color: #fff; }
    canvas { display: block; }
    #console {
      position: absolute; top: 10px; left: 10px;
      width: calc(100% - 20px); max-height: 30vh;
      overflow-y: auto; background: rgba(0,0,0,0.5);
      padding: 8px; font-size: 0.85rem;
      border-radius: 8px;
    }
    #inputBox {
      position: absolute; bottom: 10px; left: 10px;
      width: calc(100% - 20px);
      padding: 8px; border: none; border-radius: 8px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <canvas id="star"></canvas>
  <div id="console"></div>
  <input type="text" id="inputBox" placeholder='Commande: "speed:2" ou "count:200"' />

  <script>
    const canvas = document.getElementById('star'), ctx = canvas.getContext('2d');
    let w = canvas.width = window.innerWidth;
    let h = canvas.height = window.innerHeight;
    window.addEventListener('resize', () => {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
      initStars();
    });

    // Paramètres dynamiques
    let params = { speed: 1, count: 150 };

    // Générer les étoiles
    let stars = [];
    function initStars() {
      stars = Array.from({ length: params.count }, () => ({
        x: Math.random() * w,
        y: Math.random() * h,
        r: Math.random() * 1.5 + 0.5,
        dx: (Math.random() * 0.5 + 0.1) * params.speed
      }));
    }
    initStars();

    function anim() {
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, w, h);
      for (let s of stars) {
        s.x -= s.dx;
        if (s.x < 0) s.x = w;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, 2 * Math.PI);
        ctx.fillStyle = '#fff';
        ctx.fill();
      }
      requestAnimationFrame(anim);
    }
    anim();

    // Console d'affichage
    const consoleEl = document.getElementById('console');
    function log(msg) {
      const d = document.createElement('div');
      d.textContent = msg;
      consoleEl.appendChild(d);
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    // WebSocket client
    const ws = new WebSocket('ws://localhost:4000');
    ws.onopen = () => log('🔗 Connecté au serveur WebSocket');
    ws.onmessage = (ev) => {
      log('Serveur : ' + ev.data);
      interpret(ev.data);
    };
    ws.onclose = () => log('❌ Déconnecté du serveur');

    // Entrée utilisateur
    document.getElementById('inputBox').addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        const txt = e.target.value.trim();
        if (!txt) return;
        log('👤 Vous : ' + txt);
        ws.send(txt);
        e.target.value = '';
      }
    });

    // Interprétation des commandes du serveur
    function interpret(cmd) {
      const [key, val] = cmd.split(':');
      if (key === 'speed') {
        params.speed = parseFloat(val) || 1;
        stars.forEach(s => s.dx = (Math.random() * 0.5 + 0.1) * params.speed);
        log(`→ vitesse ajustée : ${params.speed}`);
      }
      if (key === 'count') {
        params.count = parseInt(val) || 150;
        initStars();
        log(`→ nombre d’étoiles ajusté : ${params.count}`);
      }
    }
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-X-U: Orchestration of the Cognitive Symphony</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0f2c; /* Very Dark Desaturated Blue */
            color: #e0e7ff; /* Light Lavender Blue */
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Orbitron', sans-serif;
        }
        .neon-text-cyan {
            color: #00d2ff;
            text-shadow: 0 0 3px #00d2ff, 0 0 6px #00d2ff;
        }
        .neon-text-pink {
            color: #ff416c;
            text-shadow: 0 0 3px #ff416c, 0 0 6px #ff416c;
        }
        .card {
            background-color: rgba(26, 30, 65, 0.7); /* Dark Desaturated Blue with transparency */
            border: 1px solid rgba(0, 210, 255, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 210, 255, 0.2);
        }
        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #00d2ff, transparent);
            margin: 3rem 0;
        }
        .flow-line {
            border-color: #00d2ff;
            opacity: 0.5;
        }
        .flow-box {
            border: 1px solid #00d2ff;
            background-color: rgba(0, 210, 255, 0.05);
        }
        .tooltip-multiline-title .chartjs-tooltip-title {
            white-space: normal !important;
        }
    </style>
</head>
<body class="antialiased">
    <!-- Application Structure Plan:
        The SPA will be a single, scrollable page with a clear narrative flow.
        1. Hero Section: Introduce N-X-U and its grand vision.
        2. The Titans: Section for each AI model (GPT-5, Claude, Gemini) using cards, highlighting strengths with text and conceptual bar charts.
        3. The Fusion (Architecture): Visual representation (HTML/CSS diagram) of N-X-U Core, modular design, and inter-model communication.
        4. The Orchestra (Implementation): Detail API integration and task orchestration, possibly with another simple HTML/CSS flow diagram.
        5. The Guardians (Security & Ethics): Bullet points with icons.
        6. The Future (Conclusion): Reinforce the "symphony of intelligences."
        Navigation will be primarily through scrolling, with a subtle sticky header for branding.
    -->
    <!-- Visualization & Content Choices:
        - Hero: Large impactful text.
        - Titans (GPT-5, Claude, Gemini): Cards. Strengths as lists. Conceptual Bar Charts (Chart.js) for "Multimodal Capability", "Reasoning", "Ethics", "Context Window". Data: Arbitrary scores (e.g., 90%, 85%) for illustration. Goal: Compare. Justification: Bar charts are good for comparing discrete categories.
        - Architecture (N-X-U Core, Modules): HTML/CSS diagram with flexbox/grid. Goal: Organize. Justification: Clear visual representation of structure without SVG/Mermaid.
        - Implementation (API, Orchestration): HTML/CSS flow diagram. Goal: Organize. Justification: Illustrate process flow.
        - Security & Ethics: Lists with Unicode icons. Goal: Inform. Justification: Concise presentation.
        - All Chart.js instances will use Canvas, have responsive:true, maintainAspectRatio:false, and include the specified tooltip callback for multiline labels. Label wrapping logic will be applied.
    -->
    <header class="sticky top-0 z-50 bg-opacity-80 backdrop-blur-md shadow-lg" style="background-color: rgba(10, 15, 44, 0.8);">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-3xl font-bold neon-text-cyan">N-X-U : The Cognitive Symphony</h1>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">

        <section id="vision" class="text-center mb-24">
            <h2 class="text-5xl font-bold mb-6 neon-text-pink">Orchestrating Tomorrow's Intelligence</h2>
            <p class="text-xl lg:text-2xl text-gray-300 max-w-3xl mx-auto mb-4">
                N-X-U (NeuraX-Ultimate): a masterful fusion of GPT-5, Claude 3.7 Sonnet, and Gemini 2.5 Pro to create a synergistic artificial intelligence, marking a new paradigm.
            </p>
            <p class="text-md text-gray-400 max-w-3xl mx-auto">
                This project aims to create an "Orchestrated General Intelligence" (OGI), where "general" capability stems from the intelligent coordination of specialized components.
            </p>
        </section>

        <div class="section-divider"></div>

        <section id="titans" class="mb-24">
            <h2 class="text-4xl font-bold text-center mb-12 neon-text-cyan">Mapping the Titans: The Pillars of N-X-U</h2>
            <div class="grid md:grid-cols-1 lg:grid-cols-3 gap-8">

                <div class="card p-6 rounded-lg">
                    <h3 class="text-3xl font-semibold mb-4 neon-text-pink">GPT-5</h3>
                    <p class="text-xl text-gray-400 mb-4 italic">The Multimodal Virtuoso</p>
                    <ul class="list-disc list-inside space-y-2 mb-6 text-gray-300">
                        <li>**Advanced Multimodality**: Processes text, images, audio, and video.</li>
                        <li>**Complex Reasoning**: Excellence in content analysis and generation.</li>
                    </ul>
                    <div class="chart-container h-64 max-h-64 max-w-md mx-auto">
                        <canvas id="gpt5Chart"></canvas>
                    </div>
                    <p class="mt-4 text-sm text-gray-400">**Role in N-X-U:** Engine for multimedia creation and complex data analysis.</p>
                </div>

                <div class="card p-6 rounded-lg">
                    <h3 class="text-3xl font-semibold mb-4 neon-text-pink">Claude 3.7 Sonnet</h3>
                    <p class="text-xl text-gray-400 mb-4 italic">The Ethical Thinker</p>
                    <ul class="list-disc list-inside space-y-2 mb-6 text-gray-300">
                        <li>**Hybrid Reasoning**: "Extended thought" mode for in-depth analysis.</li>
                        <li>**Security and Ethics**: "Constitutional AI" approach for safe interactions.</li>
                    </ul>
                    <div class="chart-container h-64 max-h-64 max-w-md mx-auto">
                        <canvas id="claudeChart"></canvas>
                    </div>
                    <p class="mt-4 text-sm text-gray-400">**Role in N-X-U:** Provides ethical reasoning and strategic planning.</p>
                </div>

                <div class="card p-6 rounded-lg">
                    <h3 class="text-3xl font-semibold mb-4 neon-text-pink">Gemini 2.5 Pro</h3>
                    <p class="text-xl text-gray-400 mb-4 italic">The Multimodal Polyglot</p>
                    <ul class="list-disc list-inside space-y-2 mb-6 text-gray-300">
                        <li>**Extended Multimodality**: Comprehensive processing of text, images, audio, video.</li>
                        <li>**Massive Context Window**: Up to 1 million tokens.</li>
                    </ul>
                    <div class="chart-container h-64 max-h-64 max-w-md mx-auto">
                        <canvas id="geminiChart"></canvas>
                    </div>
                    <p class="mt-4 text-sm text-gray-400">**Role in N-X-U:** Multimodal processing, real-time interactions, and long context management.</p>
                </div>
            </div>
        </section>

        <div class="section-divider"></div>

        <section id="architecture" class="mb-24">
            <h2 class="text-4xl font-bold text-center mb-12 neon-text-cyan">The Architecture of Fusion</h2>
            <div class="grid md:grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                <div>
                    <h3 class="text-3xl font-semibold mb-6 neon-text-pink">A. Modular Architecture</h3>
                    <p class="text-lg text-gray-300 mb-4">The core of N-X-U is its **Central Brain (N-X-U Core)**, an intelligent orchestrator that decomposes tasks and dynamically delegates them to specialized modules:</p>
                    <ul class="list-disc list-inside space-y-2 mb-6 text-gray-300 pl-4">
                        <li>**GPT-5 Module:** Multimedia creation, complex data analysis.</li>
                        <li>**Claude 3.7 Sonnet Module:** Ethical reasoning, strategic planning.</li>
                        <li>**Gemini 2.5 Pro Module:** Multimodal processing, real-time interactions.</li>
                    </ul>
                    <p class="text-gray-400 text-sm">This modular design allows for increased specialization and efficiency, forming a superior collective intelligence.</p>
                </div>
                <div class="flow-box p-6 rounded-lg">
                    <div class="text-center mb-4">
                        <div class="inline-block p-4 border-2 border-pink-500 rounded-lg shadow-lg bg-gray-800">
                            <h4 class="text-xl font-semibold neon-text-pink">N-X-U Core (Orchestrator)</h4>
                        </div>
                    </div>
                    <div class="flex justify-center items-center my-4">
                        <div class="flow-line h-12 w-px"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div class="flow-box p-3 rounded">
                            <p class="font-semibold text-cyan-400">GPT-5 Module</p>
                            <p class="text-xs text-gray-400">Creation & Analysis</p>
                        </div>
                        <div class="flow-box p-3 rounded">
                            <p class="font-semibold text-purple-400">Claude 3.7 Module</p>
                            <p class="text-xs text-gray-400">Ethics & Strategy</p>
                        </div>
                        <div class="flow-box p-3 rounded">
                            <p class="font-semibold text-teal-400">Gemini 2.5 Module</p>
                            <p class="text-xs text-gray-400">Multimodal & Real-time</p>
                        </div>
                    </div>
                    <div class="flex justify-around mt-4">
                         <div class="flow-line h-8 w-px rotate-45 transform origin-bottom-left"></div>
                         <div class="flow-line h-8 w-px"></div>
                         <div class="flow-line h-8 w-px -rotate-45 transform origin-bottom-right"></div>
                    </div>
                </div>
            </div>
             <div class="mt-12">
                <h3 class="text-3xl font-semibold mb-6 neon-text-pink">B. Inter-Model Communication</h3>
                <p class="text-lg text-gray-300 mb-4">Standardized **RESTful APIs** ensure communication. A major challenge is guaranteeing consistent semantic understanding between models.</p>
                <p class="text-lg text-gray-300">**Conflict Management** uses meta-reasoning to evaluate and unify outputs, based on reliability, relevance, and ethical compliance.</p>
            </div>
        </section>

        <div class="section-divider"></div>

        <section id="implementation" class="mb-24">
            <h2 class="text-4xl font-bold text-center mb-12 neon-text-cyan">Technical Implementation</h2>
            <div class="grid md:grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                <div>
                    <h3 class="text-3xl font-semibold mb-6 neon-text-pink">A. API Integration</h3>
                    <p class="text-lg text-gray-300 mb-4">API integration for each model is the first step, involving:</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-300 pl-4">
                        <li>Secure configuration of API keys.</li>
                        <li>Management of rate limits.</li>
                        <li>Processing of diverse multimodal input/output formats.</li>
                    </ul>
                </div>
                <div class="flow-box p-6 rounded-lg">
                    <h3 class="text-3xl font-semibold mb-6 neon-text-pink">B. Task Orchestration</h3>
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <span class="text-2xl mr-4">📥</span>
                            <div>
                                <h4 class="font-semibold text-cyan-400">Request Management System</h4>
                                <p class="text-sm text-gray-400">Analyzes the task and directs it to the most suitable module via NLU and classifiers.</p>
                            </div>
                        </div>
                        <div class="text-center text-2xl neon-text-pink">↓</div>
                        <div class="flex items-center">
                             <span class="text-2xl mr-4">🧩</span>
                            <div>
                                <h4 class="font-semibold text-cyan-400">Results Aggregation</h4>
                                <p class="text-sm text-gray-400">Merges responses (semantic fusion, redundancy elimination, inconsistency resolution) for consistent output.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="section-divider"></div>

        <section id="ethics" class="mb-24">
            <h2 class="text-4xl font-bold text-center mb-12 neon-text-cyan">Pillars of Trust: Security and Ethics</h2>
            <div class="grid md:grid-cols-2 gap-8 text-lg text-gray-300">
                <div class="card p-6 rounded-lg">
                    <h3 class="text-2xl font-semibold mb-3 neon-text-pink">🛡️ Content Filtering</h3>
                    <p>Implementation of advanced filters (beyond keywords) to proactively prevent the generation of harmful, biased, or misleading content, both inbound and outbound.</p>
                </div>
                <div class="card p-6 rounded-lg">
                    <h3 class="text-2xl font-semibold mb-3 neon-text-pink">⚖️ Decision Auditing</h3>
                    <p>Meticulous logging of each request, involved models, their outputs, and the resolution process to ensure traceability, accountability, and continuous improvement.</p>
                </div>
            </div>
            <p class="mt-8 text-center text-gray-400 text-md">The architectural integration of ethics, notably via the Claude 3.7 Sonnet module, is fundamental for responsible deployment.</p>
        </section>

        <div class="section-divider"></div>

        <section id="future" class="text-center">
            <h2 class="text-5xl font-bold mb-6 neon-text-cyan">To Infinity and Beyond</h2>
            <p class="text-xl lg:text-2xl text-gray-300 max-w-3xl mx-auto mb-4">
                By integrating these three AI giants, N-X-U will become an entity capable of understanding, reasoning, and creating with unparalleled depth.
            </p>
            <p class="text-lg text-gray-400 max-w-3xl mx-auto neon-text-pink font-semibold">
                A symphony of intelligences, orchestrated by human genius.
            </p>
        </section>
    </main>

    <footer class="text-center py-8 mt-12 border-t border-gray-700">
        <p class="text-gray-500">&copy; 2025 N-X-U Initiative. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tooltipCallback = {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            };

            const processLabels = (labels) => {
                return labels.map(label => {
                    if (label.length > 16) {
                        const words = label.split(' ');
                        const newLabel = [];
                        let currentLine = '';
                        words.forEach(word => {
                            if ((currentLine + word).length > 16 && currentLine.length > 0) {
                                newLabel.push(currentLine.trim());
                                currentLine = word + ' ';
                            } else {
                                currentLine += word + ' ';
                            }
                        });
                        if (currentLine.trim().length > 0) {
                            newLabel.push(currentLine.trim());
                        }
                        return newLabel;
                    }
                    return label;
                });
            };

            const commonChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#e0e7ff'
                        }
                    },
                    tooltip: {
                        callbacks: tooltipCallback,
                        bodyColor: '#e0e7ff',
                        titleColor: '#e0e7ff',
                        backgroundColor: 'rgba(26, 30, 65, 0.9)', // Card background color
                        borderColor: '#00d2ff',
                        borderWidth: 1
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100, // Assuming scores are percentages
                        ticks: {
                            color: '#e0e7ff',
                            stepSize: 20
                        },
                        grid: {
                            color: 'rgba(0, 210, 255, 0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#e0e7ff'
                        },
                        grid: {
                            color: 'rgba(0, 210, 255, 0.1)'
                        }
                    }
                }
            };

            // GPT-5 Chart
            const gpt5Labels = processLabels(['Advanced Multimodality', 'Complex Reasoning', 'Generative Power']);
            const gpt5Data = {
                labels: gpt5Labels,
                datasets: [{
                    label: 'GPT-5 Capabilities (Conceptual)',
                    data: [95, 92, 90], // Conceptual scores
                    backgroundColor: 'rgba(0, 210, 255, 0.6)', // Cyan
                    borderColor: 'rgba(0, 210, 255, 1)',
                    borderWidth: 1
                }]
            };
            new Chart(document.getElementById('gpt5Chart'), { type: 'bar', data: gpt5Data, options: commonChartOptions });

            // Claude 3.7 Sonnet Chart
            const claudeLabels = processLabels(['Hybrid Reasoning', 'Security & Ethics', 'Extended Thought']);
            const claudeData = {
                labels: claudeLabels,
                datasets: [{
                    label: 'Claude 3.7 Sonnet Capabilities (Conceptual)',
                    data: [88, 98, 85], // Conceptual scores
                    backgroundColor: 'rgba(138, 43, 226, 0.6)', // Purple
                    borderColor: 'rgba(138, 43, 226, 1)',
                    borderWidth: 1
                }]
            };
            new Chart(document.getElementById('claudeChart'), { type: 'bar', data: claudeData, options: commonChartOptions });

            // Gemini 2.5 Pro Chart
            const geminiLabels = processLabels(['Extended Multimodality', 'Massive Context Window', 'Real-time Processing']);
            const geminiData = {
                labels: geminiLabels,
                datasets: [{
                    label: 'Gemini 2.5 Pro Capabilities (Conceptual)',
                    data: [93, 99, 89], // Conceptual scores
                    backgroundColor: 'rgba(255, 65, 108, 0.6)', // Pink/Red
                    borderColor: 'rgba(255, 65, 108, 1)',
                    borderWidth: 1
                }]
            };
            new Chart(document.getElementById('geminiChart'), { type: 'bar', data: geminiData, options: commonChartOptions });
        });
    </script>
</body>
</html>
import React, { useState, useEffect, useRef } from 'react';

// Main App component
const App = () => {
  return (
    // Futuristic galactic background
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-indigo-900 p-4 font-sans text-gray-100 flex items-center justify-center">
      <div className="container mx-auto p-6 bg-gray-800 rounded-3xl shadow-2xl shadow-purple-500/50 border border-purple-700">
        <h1 className="text-5xl font-extrabold text-center text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400 mb-12 animate-pulse">
          Bienvenue sur neuraX-ultime
        </h1>
        <div className="flex justify-center">
          {/* Only neuraX-ultime Chatbot */}
          <Chatbot title="neuraX-ultime" modelName="gemini-neurax" />
        </div>
      </div>
    </div>
  );
};

// Chatbot component
const Chatbot = ({ title, modelName }) => {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const messagesEndRef = useRef(null);

  // Scroll to the bottom of the chat messages
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // Function to send a message and get a response from the LLM
  const sendMessage = async () => {
    if (input.trim() === '') return;

    const userMessage = { sender: 'user', text: input };
    setMessages((prevMessages) => [...prevMessages, userMessage]);
    setInput('');
    setLoading(true);

    try {
      let botResponseText = '';

      // Prepare chat history for the LLM, adding a system instruction for the persona
      let chatHistory = [];
      let systemInstruction = "";

      // Assign persona based on modelName
      switch (modelName) {
        case "gemini-neurax":
          systemInstruction = "Vous êtes neuraX-ultime, un assistant avancé spécialisé dans la résolution de problèmes complexes, la génération de solutions innovantes et la fourniture d'informations de pointe avec une touche futuriste et galactique.";
          break;
        default:
          systemInstruction = "Vous êtes un assistant utile.";
      }

      // Add system instruction as the first message if needed, or include in user prompt
      // For simplicity and direct API call, we'll prepend the instruction to the user's current input.
      const fullPrompt = `${systemInstruction}\n\n${input}`;

      // Build chat history for the LLM
      chatHistory.push({ role: "user", parts: [{ text: fullPrompt }] });

      const payload = { contents: chatHistory };
      const apiKey = ""; // API key will be provided by the Canvas environment
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const result = await response.json();

      if (result.candidates && result.candidates.length > 0 &&
          result.candidates[0].content && result.candidates[0].content.parts &&
          result.candidates[0].content.parts.length > 0) {
        botResponseText = result.candidates[0].content.parts[0].text;
      } else {
        botResponseText = `Désolé, le modèle ${title} n'a pas pu générer de réponse. Veuillez réessayer.`;
        console.error(`Erreur: Structure de réponse inattendue de l'API Gemini pour ${title}`, result);
      }

      const botMessage = { sender: 'bot', text: botResponseText };
      setMessages((prevMessages) => [...prevMessages, botMessage]);

    } catch (error) {
      const errorMessage = { sender: 'bot', text: `Une erreur est survenue lors de la communication avec le chatbot ${title}.` };
      setMessages((prevMessages) => [...prevMessages, errorMessage]);
      console.error(`Erreur lors de l'appel de l'API pour ${title}:`, error);
    } finally {
      setLoading(false);
    }
  };

  // Handle Enter key press
  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !loading) {
      sendMessage();
    }
  };

  return (
    <div className="bg-gradient-to-br from-gray-700 to-gray-800 rounded-2xl shadow-xl shadow-blue-500/30 border border-blue-600 flex flex-col h-[600px] w-full max-w-2xl mx-auto">
      <div className="p-4 bg-gradient-to-r from-indigo-700 to-purple-700 text-white rounded-t-2xl text-2xl font-bold text-center border-b border-purple-500">
        {title}
      </div>
      <div className="flex-1 p-4 overflow-y-auto space-y-3 custom-scrollbar bg-gray-900">
        {messages.length === 0 && (
          <div className="text-center text-gray-400 mt-10">
            Bienvenue sur neuraX-ultime ! Posez-moi une question complexe ou demandez une idée innovante.
          </div>
        )}
        {messages.map((msg, index) => (
          <div
            key={index}
            className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}
          >
            <div
              className={`max-w-[70%] p-3 rounded-xl shadow-md ${
                msg.sender === 'user'
                  ? 'bg-blue-600 text-white rounded-br-none'
                  : 'bg-gray-600 text-gray-100 rounded-bl-none'
              }`}
            >
              {msg.text}
            </div>
          </div>
        ))}
        {loading && (
          <div className="flex justify-start">
            <div className="max-w-[70%] p-3 rounded-xl shadow-md bg-gray-600 text-gray-100 rounded-bl-none">
              <div className="flex items-center">
                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce mr-1"></div>
                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-150 mr-1"></div>
                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-300"></div>
              </div>
            </div>
          </div>
        )}
        <div ref={messagesEndRef} />
      </div>
      <div className="p-4 border-t border-gray-700 flex items-center bg-gray-800 rounded-b-2xl">
        <input
          type="text"
          className="flex-1 p-3 border border-gray-600 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white placeholder-gray-400"
          placeholder="Tapez votre message..."
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyPress={handleKeyPress}
          disabled={loading}
        />
        <button
          onClick={sendMessage}
          className="ml-3 px-6 py-3 bg-purple-600 text-white rounded-full shadow-lg hover:bg-purple-700 transition duration-300 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
          disabled={loading}
        >
          Envoyer
        </button>
      </div>
    </div>
  );
};

export default App;

